import{j as e,I as M,d as V,r as o,P as S,n as ie,h as q,a as C,g as ce,u as le,e as de,o as ue,p as me,l as pe,m as he,q as fe,s as z,L,B as k}from"./index-DYacXVkv.js";import{L as b}from"./label-q1lYILn_.js";import{g as xe}from"./formatting-BKpwSQEA.js";import{B as ve,a as ge,b as P,c as R,d as $}from"./breadcrumb-DpQ7pJq6.js";import{T as je}from"./textarea-DeD0OxOn.js";const be=({id:s,label:r,type:a,defaultValue:n,handleChange:i})=>e.jsxs("div",{children:[e.jsx(b,{htmlFor:s,children:r}),e.jsx(M,{id:s,type:a,defaultValue:n,onChange:i,className:"text-lg"})]}),A=be,Ne=()=>e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-3xl text-destructive",children:"Oops!"}),e.jsx("p",{children:"Une erreur s'est produite."})]}),ye=Ne;var _="Avatar",[we,Ve]=V(_),[Ce,H]=we(_),O=o.forwardRef((s,r)=>{const{__scopeAvatar:a,...n}=s,[i,l]=o.useState("idle");return e.jsx(Ce,{scope:a,imageLoadingStatus:i,onImageLoadingStatusChange:l,children:e.jsx(S.span,{...n,ref:r})})});O.displayName=_;var U="AvatarImage",D=o.forwardRef((s,r)=>{const{__scopeAvatar:a,src:n,onLoadingStatusChange:i=()=>{},...l}=s,t=H(U,a),c=Se(n),d=ie(m=>{i(m),t.onImageLoadingStatusChange(m)});return q(()=>{c!=="idle"&&d(c)},[c,d]),c==="loaded"?e.jsx(S.img,{...l,ref:r,src:n}):null});D.displayName=U;var G="AvatarFallback",X=o.forwardRef((s,r)=>{const{__scopeAvatar:a,delayMs:n,...i}=s,l=H(G,a),[t,c]=o.useState(n===void 0);return o.useEffect(()=>{if(n!==void 0){const d=window.setTimeout(()=>c(!0),n);return()=>window.clearTimeout(d)}},[n]),t&&l.imageLoadingStatus!=="loaded"?e.jsx(S.span,{...i,ref:r}):null});X.displayName=G;function Se(s){const[r,a]=o.useState("idle");return q(()=>{if(!s){a("error");return}let n=!0;const i=new window.Image,l=t=>()=>{n&&a(t)};return a("loading"),i.onload=l("loaded"),i.onerror=l("error"),i.src=s,()=>{n=!1}},[s]),r}var K=O,W=D,J=X;const Q=o.forwardRef(({className:s,...r},a)=>e.jsx(K,{ref:a,className:C("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r}));Q.displayName=K.displayName;const Y=o.forwardRef(({className:s,...r},a)=>e.jsx(W,{ref:a,className:C("aspect-square h-full w-full",s),...r}));Y.displayName=W.displayName;const Z=o.forwardRef(({className:s,...r},a)=>e.jsx(J,{ref:a,className:C("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r}));Z.displayName=J.displayName;function ke({name:s,address:r,profilePicture:a,coverImage:n}){return e.jsxs("div",{className:"hero w-full aspect-video relative max-h-[40vh] sm:max-h-[20vh] rounded-md overflow-hidden",style:{backgroundImage:`url(${n[0]})`},children:[e.jsx("div",{className:"hero-overlay bg-opacity-40"}),e.jsx("div",{className:"hero-content text-neutral-content mt-auto mr-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(Q,{className:"w-14 h-14",children:[e.jsx(Y,{src:a,className:"border-2 rounded-full border-primary-800"}),e.jsx(Z,{className:"text-xl",children:s&&xe(s)})]}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:s}),e.jsx("p",{children:r})]})]})})]})}var F="Switch",[Ae,qe]=V(F),[Ee,Ie]=Ae(F),ee=o.forwardRef((s,r)=>{const{__scopeSwitch:a,name:n,checked:i,defaultChecked:l,required:t,disabled:c,value:d="on",onCheckedChange:m,...N}=s,[p,x]=o.useState(null),E=ce(r,v=>x(v)),y=o.useRef(!1),j=p?!!p.closest("form"):!0,[h=!1,I]=le({prop:i,defaultProp:l,onChange:m});return e.jsxs(Ee,{scope:a,checked:h,disabled:c,children:[e.jsx(S.button,{type:"button",role:"switch","aria-checked":h,"aria-required":t,"data-state":te(h),"data-disabled":c?"":void 0,disabled:c,value:d,...N,ref:E,onClick:de(s.onClick,v=>{I(w=>!w),j&&(y.current=v.isPropagationStopped(),y.current||v.stopPropagation())})}),j&&e.jsx(Le,{control:p,bubbles:!y.current,name:n,value:d,checked:h,required:t,disabled:c,style:{transform:"translateX(-100%)"}})]})});ee.displayName=F;var se="SwitchThumb",ae=o.forwardRef((s,r)=>{const{__scopeSwitch:a,...n}=s,i=Ie(se,a);return e.jsx(S.span,{"data-state":te(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:r})});ae.displayName=se;var Le=s=>{const{control:r,checked:a,bubbles:n=!0,...i}=s,l=o.useRef(null),t=ue(a),c=me(r);return o.useEffect(()=>{const d=l.current,m=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(m,"checked").set;if(t!==a&&p){const x=new Event("click",{bubbles:n});p.call(d,a),d.dispatchEvent(x)}},[t,a,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...i,tabIndex:-1,ref:l,style:{...s.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function te(s){return s?"checked":"unchecked"}var re=ee,Pe=ae;const T=o.forwardRef(({className:s,...r},a)=>e.jsx(re,{className:C("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...r,ref:a,children:e.jsx(Pe,{className:C("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));T.displayName=re.displayName;const Re=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,Me=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,Te=["image/jpeg","image/jpg","image/png"];function He(){const[s,r]=o.useState(),[a,n]=o.useState(),[i,l]=o.useState(!0),[t,c]=o.useState(),[d,m]=o.useState(!1),[N,p]=o.useState(!1),x=pe(),E=he(),y=fe();async function j(){var u;try{const g=await x.get("/api/users");r(g.data)}catch(g){n(g),((u=g.response)==null?void 0:u.status)===401&&E("/login",{state:{from:y},replace:!0})}l(!1)}o.useEffect(()=>{j()},[]);const h=u=>{c({...t,[u.target.id]:u.target.value})},I=async u=>{if(u.preventDefault(),m(!0),!Object.keys(t).some(f=>t[f]!==s[f])){c(),m(!1);return}if(t.phoneNumber&&!Re.test(t.phoneNumber)){p("Le numéro de téléphone n'est pas valide"),m(!1);return}if(t.email&&!Me.test(t.email)){p("L'adresse email n'est pas valide"),m(!1);return}try{await x.patch("/api/users",t),await j()}catch(f){f.response?p(f.response.data.message):p("Une erreur est survenue, veuillez réessayer plus tard")}c(),m(!1)},v=async u=>{const{id:g,files:f}=u.target;if(!Te.includes(f[0].type))return alert("Invalid file type");const B=new FormData;B.append("profile",f[0]);try{await x.post(`/api/users/${g}`,B,{headers:{"Content-Type":"multipart/form-data"}}),j()}catch(oe){console.error(oe)}},w=o.useRef(null),ne=()=>{w.current&&(w.current.reset(),c())};return i?e.jsx(z,{className:"w-8 h-8 animate-spin flex-1"}):a?e.jsx(ye,{errMsg:a}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col gap-4",children:[e.jsx(ve,{children:e.jsxs(ge,{children:[e.jsx(P,{children:e.jsx(R,{asChild:!0,children:e.jsx(L,{to:"/",children:"Tableau de bord"})})}),e.jsx($,{}),e.jsx(P,{children:e.jsx(R,{asChild:!0,children:e.jsx(L,{to:"/salon",children:"Salon"})})}),e.jsx($,{}),e.jsx(P,{children:e.jsx(R,{asChild:!0,children:e.jsx(L,{to:"/salon/informations",children:"Informations"})})})]})}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsx(ke,{name:s.providerName,address:s.address,profilePicture:s.profilePicture,coverImage:s.coverImage}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(k,{asChild:!0,children:e.jsx(b,{htmlFor:"profile",className:" w-full",children:"Changer ma photo de profil"})}),e.jsx(M,{className:"hidden",type:"file",id:"profile",onChange:v}),e.jsx(k,{asChild:!0,children:e.jsx(b,{htmlFor:"cover",className:" w-full",children:"Changer mes photos de couverture"})}),e.jsx(M,{className:"hidden",type:"file",id:"cover",onChange:v})]}),e.jsxs("form",{className:"space-y-2",ref:w,children:[e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(A,{id:"providerName",label:"Nom du salon",type:"text",defaultValue:s.providerName,handleChange:h}),e.jsx(A,{id:"phoneNumber",label:"Téléphone",type:"tel",defaultValue:s.phoneNumber,handleChange:h}),e.jsx(A,{id:"address",label:"Adresse",type:"text",defaultValue:s.address,handleChange:h}),e.jsx(A,{id:"email",label:"Email",type:"email",defaultValue:s.email,handleChange:h})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(T,{id:"autoAccept",checked:(t==null?void 0:t.autoAcceptAppointments)??s.autoAcceptAppointments,onCheckedChange:u=>{c({...t,autoAcceptAppointments:u})}})]}),e.jsxs("p",{className:"text-muted",children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(T,{id:"vacancyMode",checked:(t==null?void 0:t.isInVacancyMode)??s.isInVacancyMode,onCheckedChange:u=>{c({...t,isInVacancyMode:u})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:"text-muted",children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(b,{htmlFor:"terms",children:"Conditions de réservation"}),e.jsx(je,{id:"bookingTerms",type:"text",defaultValue:s.bookingTerms,onChange:h,className:"text-lg whitespace-pre-line"})]}),N&&setTimeout(()=>p(null),3e3)&&e.jsx("p",{className:"text-destructive text-sm",children:N}),t&&e.jsxs(e.Fragment,{children:[e.jsx(k,{onClick:I,disabled:d&&!0,children:d?e.jsx(z,{className:"animate-spin"}):"Enregistrer les modifications"}),e.jsx(k,{variant:"outline",className:"block",onClick:ne,children:"Annuler les modifications"})]})]})]})}export{He as default};

import{c as le,j as e,I as T,d as H,r as o,P as C,n as de,h as O,a as k,B as j,g as ue,u as me,e as pe,o as he,p as fe,l as xe,m as ve,q as ge,s as $,L}from"./index-CQvMpwoX.js";import{L as y}from"./label-B-FvIV5S.js";import{g as je}from"./formatting-BKpwSQEA.js";import{P as be,a as ye,b as Ne}from"./popover-ABNCNRmM.js";import{B as we,a as ke,b as R,c as M,d as q}from"./breadcrumb-CEn0L5xu.js";import{T as Ce}from"./textarea-CZA0vZLZ.js";import"./index-Cey5LfNh.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=le("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ae=({id:a,label:r,type:s,defaultValue:n,handleChange:c})=>e.jsxs("div",{children:[e.jsx(y,{htmlFor:a,children:r}),e.jsx(T,{id:a,type:s,defaultValue:n,onChange:c,className:"text-lg"})]}),S=Ae,Ee=()=>e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-3xl text-destructive",children:"Oops!"}),e.jsx("p",{children:"Une erreur s'est produite."})]}),Pe=Ee;var F="Avatar",[Ie,We]=H(F),[Le,U]=Ie(F),D=o.forwardRef((a,r)=>{const{__scopeAvatar:s,...n}=a,[c,l]=o.useState("idle");return e.jsx(Le,{scope:s,imageLoadingStatus:c,onImageLoadingStatusChange:l,children:e.jsx(C.span,{...n,ref:r})})});D.displayName=F;var G="AvatarImage",X=o.forwardRef((a,r)=>{const{__scopeAvatar:s,src:n,onLoadingStatusChange:c=()=>{},...l}=a,t=U(G,s),i=Re(n),u=de(m=>{c(m),t.onImageLoadingStatusChange(m)});return O(()=>{i!=="idle"&&u(i)},[i,u]),i==="loaded"?e.jsx(C.img,{...l,ref:r,src:n}):null});X.displayName=G;var K="AvatarFallback",W=o.forwardRef((a,r)=>{const{__scopeAvatar:s,delayMs:n,...c}=a,l=U(K,s),[t,i]=o.useState(n===void 0);return o.useEffect(()=>{if(n!==void 0){const u=window.setTimeout(()=>i(!0),n);return()=>window.clearTimeout(u)}},[n]),t&&l.imageLoadingStatus!=="loaded"?e.jsx(C.span,{...c,ref:r}):null});W.displayName=K;function Re(a){const[r,s]=o.useState("idle");return O(()=>{if(!a){s("error");return}let n=!0;const c=new window.Image,l=t=>()=>{n&&s(t)};return s("loading"),c.onload=l("loaded"),c.onerror=l("error"),c.src=a,()=>{n=!1}},[a]),r}var J=D,Q=X,Y=W;const Z=o.forwardRef(({className:a,...r},s)=>e.jsx(J,{ref:s,className:k("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...r}));Z.displayName=J.displayName;const ee=o.forwardRef(({className:a,...r},s)=>e.jsx(Q,{ref:s,className:k("aspect-square h-full w-full",a),...r}));ee.displayName=Q.displayName;const ae=o.forwardRef(({className:a,...r},s)=>e.jsx(Y,{ref:s,className:k("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...r}));ae.displayName=Y.displayName;function Me({name:a,address:r,profilePicture:s,coverImage:n,rmprofile:c,rmcover:l}){const t=async i=>{try{i==="profile"&&await c(),i==="cover"&&await l()}catch(u){console.error(u)}};return e.jsxs("div",{className:"hero w-full aspect-video relative max-h-[40vh] sm:max-h-[20vh] rounded-md overflow-hidden",style:{backgroundImage:`url(${n&&n})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"hero-overlay bg-opacity-40"}),e.jsx("div",{className:"hero-content text-neutral-content mt-auto mr-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(Z,{className:"w-14 h-14",children:[e.jsx(ee,{src:s,className:"border-2 rounded-full border-primary-800"}),e.jsx(ae,{className:"text-xl",children:a&&je(a)})]}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:a}),e.jsx("p",{children:r})]})]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(be,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(j,{variant:"destructive",children:e.jsx(Se,{})})}),e.jsxs(Ne,{align:"end",className:"w-fit flex flex-col gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>t("profile"),children:"Supprimer la photo de profil"}),e.jsx(j,{variant:"outline",onClick:()=>t("cover"),children:"Supprimer la photo de couverture"})]})]})})]})}var B="Switch",[Te,Je]=H(B),[_e,Fe]=Te(B),se=o.forwardRef((a,r)=>{const{__scopeSwitch:s,name:n,checked:c,defaultChecked:l,required:t,disabled:i,value:u="on",onCheckedChange:m,...N}=a,[p,f]=o.useState(null),A=ue(r,h=>f(h)),w=o.useRef(!1),x=p?!!p.closest("form"):!0,[b=!1,E]=me({prop:c,defaultProp:l,onChange:m});return e.jsxs(_e,{scope:s,checked:b,disabled:i,children:[e.jsx(C.button,{type:"button",role:"switch","aria-checked":b,"aria-required":t,"data-state":ne(b),"data-disabled":i?"":void 0,disabled:i,value:u,...N,ref:A,onClick:pe(a.onClick,h=>{E(P=>!P),x&&(w.current=h.isPropagationStopped(),w.current||h.stopPropagation())})}),x&&e.jsx(Be,{control:p,bubbles:!w.current,name:n,value:u,checked:b,required:t,disabled:i,style:{transform:"translateX(-100%)"}})]})});se.displayName=B;var te="SwitchThumb",re=o.forwardRef((a,r)=>{const{__scopeSwitch:s,...n}=a,c=Fe(te,s);return e.jsx(C.span,{"data-state":ne(c.checked),"data-disabled":c.disabled?"":void 0,...n,ref:r})});re.displayName=te;var Be=a=>{const{control:r,checked:s,bubbles:n=!0,...c}=a,l=o.useRef(null),t=he(s),i=fe(r);return o.useEffect(()=>{const u=l.current,m=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(m,"checked").set;if(t!==s&&p){const f=new Event("click",{bubbles:n});p.call(u,s),u.dispatchEvent(f)}},[t,s,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...c,tabIndex:-1,ref:l,style:{...a.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function ne(a){return a?"checked":"unchecked"}var oe=se,ze=re;const _=o.forwardRef(({className:a,...r},s)=>e.jsx(oe,{className:k("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...r,ref:s,children:e.jsx(ze,{className:k("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));_.displayName=oe.displayName;const Ve=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,$e=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,qe=["image/jpeg","image/jpg","image/png"];function Qe(){const[a,r]=o.useState(),[s,n]=o.useState(),[c,l]=o.useState(!0),[t,i]=o.useState(),[u,m]=o.useState(!1),[N,p]=o.useState(!1),f=xe(),A=ve(),w=ge();async function x(){var d;try{const v=await f.get("/api/users");r(v.data)}catch(v){n(v),((d=v.response)==null?void 0:d.status)===401&&A("/login",{state:{from:w},replace:!0})}l(!1)}const b=async()=>{try{await f.delete("/api/users/profile",{profilePicture:null}),await x()}catch(d){console.log(d)}},E=async()=>{try{await f.delete("/api/users/cover",{coverImage:null}),await x()}catch(d){console.log(d)}};o.useEffect(()=>{x()},[]);const h=d=>{i({...t,[d.target.id]:d.target.value})},P=async d=>{if(d.preventDefault(),m(!0),!Object.keys(t).some(g=>t[g]!==a[g])){i(),m(!1);return}if(t.phoneNumber&&!Ve.test(t.phoneNumber)){p("Le numéro de téléphone n'est pas valide"),m(!1);return}if(t.email&&!$e.test(t.email)){p("L'adresse email n'est pas valide"),m(!1);return}try{await f.patch("/api/users",t),await x()}catch(g){g.response?p(g.response.data.message):p("Une erreur est survenue, veuillez réessayer plus tard")}i(),m(!1)},z=async d=>{const{id:v,files:g}=d.target;if(!qe.includes(g[0].type))return alert("Invalid file type");const V=new FormData;V.append(v,g[0]);try{await f.post(`/api/users/${v}`,V,{headers:{"Content-Type":"multipart/form-data"}}),x()}catch(ce){console.error(ce)}},I=o.useRef(null),ie=()=>{I.current&&(I.current.reset(),i())};return c?e.jsx($,{className:"w-8 h-8 animate-spin flex-1"}):s?e.jsx(Pe,{errMsg:s}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col gap-4",children:[e.jsx(we,{children:e.jsxs(ke,{children:[e.jsx(R,{children:e.jsx(M,{asChild:!0,children:e.jsx(L,{to:"/",children:"Tableau de bord"})})}),e.jsx(q,{}),e.jsx(R,{children:e.jsx(M,{asChild:!0,children:e.jsx(L,{to:"/salon",children:"Salon"})})}),e.jsx(q,{}),e.jsx(R,{children:e.jsx(M,{asChild:!0,children:e.jsx(L,{to:"/salon/informations",children:"Informations"})})})]})}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsx(Me,{name:a.providerName,address:a.address,profilePicture:a.profilePicture,coverImage:a.coverImage,rmprofile:b,rmcover:E}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(j,{asChild:!0,children:e.jsx(y,{htmlFor:"profile",className:" w-full",children:"Changer ma photo de profil"})}),e.jsx(T,{className:"hidden",type:"file",id:"profile",onChange:z}),e.jsx(j,{asChild:!0,children:e.jsx(y,{htmlFor:"cover",className:" w-full",children:"Changer ma photo de couverture"})}),e.jsx(T,{className:"hidden",type:"file",id:"cover",onChange:z})]}),e.jsxs("form",{className:"space-y-2",ref:I,children:[e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(S,{id:"providerName",label:"Nom du salon",type:"text",defaultValue:a.providerName,handleChange:h}),e.jsx(S,{id:"phoneNumber",label:"Téléphone",type:"tel",defaultValue:a.phoneNumber,handleChange:h}),e.jsx(S,{id:"address",label:"Adresse",type:"text",defaultValue:a.address,handleChange:h}),e.jsx(S,{id:"email",label:"Email",type:"email",defaultValue:a.email,handleChange:h})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(_,{id:"autoAccept",checked:(t==null?void 0:t.autoAcceptAppointments)??a.autoAcceptAppointments,onCheckedChange:d=>{i({...t,autoAcceptAppointments:d})}})]}),e.jsxs("p",{className:"text-muted",children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(_,{id:"vacancyMode",checked:(t==null?void 0:t.isInVacancyMode)??a.isInVacancyMode,onCheckedChange:d=>{i({...t,isInVacancyMode:d})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:"text-muted",children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(y,{htmlFor:"terms",children:"Conditions de réservation"}),e.jsx(Ce,{id:"bookingTerms",type:"text",defaultValue:a.bookingTerms,onChange:h,className:"text-lg whitespace-pre-line"})]}),N&&setTimeout(()=>p(null),3e3)&&e.jsx("p",{className:"text-destructive text-sm",children:N}),t&&e.jsxs(e.Fragment,{children:[e.jsx(j,{onClick:P,disabled:u&&!0,children:u?e.jsx($,{className:"animate-spin"}):"Enregistrer les modifications"}),e.jsx(j,{variant:"outline",className:"block",onClick:ie,children:"Annuler les modifications"})]})]})]})}export{Qe as default};

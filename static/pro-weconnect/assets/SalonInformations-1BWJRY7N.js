import{c as fe,j as e,I as z,f as G,r as n,P as M,g as xe,h as W,a as A,B as y,i as ve,k as ge,l as je,m as be,n as ye,u as Ne,e as we,o as ke,L as T,p as Ce,J as f}from"./index-By7jrq8X.js";import{L as C,T as Se}from"./textarea-B5HrQc9l.js";import{g as Ae,P as Me,a as Ie,b as Pe}from"./popover-7RJVBBS8.js";import{B as Ee,a as Le,b as _,c as V,d as D}from"./breadcrumb-CxMIDZUd.js";import{u as Re}from"./useAxiosPrivate-CXJOWlCB.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=fe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_e=({id:t,name:r="",label:s,type:a,defaultValue:o,placeholder:c=null,handleChange:l})=>e.jsxs("div",{children:[e.jsx(C,{htmlFor:t,children:s}),e.jsx(z,{id:t,type:a,name:r,value:o,placeholder:c,onChange:l,className:"text-lg"})]}),k=_e,Ve=()=>e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-3xl text-destructive",children:"Oops!"}),e.jsx("p",{children:"Une erreur s'est produite."})]}),ze=Ve;var F="Avatar",[Be,st]=G(F),[Fe,X]=Be(F),J=n.forwardRef((t,r)=>{const{__scopeAvatar:s,...a}=t,[o,c]=n.useState("idle");return e.jsx(Fe,{scope:s,imageLoadingStatus:o,onImageLoadingStatusChange:c,children:e.jsx(M.span,{...a,ref:r})})});J.displayName=F;var K="AvatarImage",Q=n.forwardRef((t,r)=>{const{__scopeAvatar:s,src:a,onLoadingStatusChange:o=()=>{},...c}=t,l=X(K,s),i=$e(a),d=xe(x=>{o(x),l.onImageLoadingStatusChange(x)});return W(()=>{i!=="idle"&&d(i)},[i,d]),i==="loaded"?e.jsx(M.img,{...c,ref:r,src:a}):null});Q.displayName=K;var Y="AvatarFallback",Z=n.forwardRef((t,r)=>{const{__scopeAvatar:s,delayMs:a,...o}=t,c=X(Y,s),[l,i]=n.useState(a===void 0);return n.useEffect(()=>{if(a!==void 0){const d=window.setTimeout(()=>i(!0),a);return()=>window.clearTimeout(d)}},[a]),l&&c.imageLoadingStatus!=="loaded"?e.jsx(M.span,{...o,ref:r}):null});Z.displayName=Y;function $e(t){const[r,s]=n.useState("idle");return W(()=>{if(!t){s("error");return}let a=!0;const o=new window.Image,c=l=>()=>{a&&s(l)};return s("loading"),o.onload=c("loaded"),o.onerror=c("error"),o.src=t,()=>{a=!1}},[t]),r}var ee=J,te=Q,ae=Z;const se=n.forwardRef(({className:t,...r},s)=>e.jsx(ee,{ref:s,className:A("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r}));se.displayName=ee.displayName;const re=n.forwardRef(({className:t,...r},s)=>e.jsx(te,{ref:s,className:A("aspect-square h-full w-full",t),...r}));re.displayName=te.displayName;const oe=n.forwardRef(({className:t,...r},s)=>e.jsx(ae,{ref:s,className:A("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r}));oe.displayName=ae.displayName;function qe({name:t,address:r,profilePicture:s,coverImage:a,rmprofile:o,rmcover:c}){const l=async i=>{try{i==="profile"&&await o(),i==="cover"&&await c()}catch(d){console.error(d)}};return e.jsxs("div",{className:"hero w-full aspect-video relative max-h-[40vh] sm:max-h-[20vh] rounded-md overflow-hidden",style:{backgroundImage:`url(${a&&a})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"hero-overlay bg-opacity-40"}),e.jsx("div",{className:"hero-content text-neutral-content mt-auto mr-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(se,{className:"w-16 h-16",children:[e.jsx(re,{src:s}),e.jsx(oe,{className:"text-2xl",children:t&&Ae(t)})]}),e.jsxs("div",{className:"ml-4 space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold bg-muted px-2 py-1 rounded-sm w-fit",children:t}),e.jsx("p",{className:"bg-muted px-2 py-1 rounded-sm w-fit",children:r})]})]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(Me,{children:[e.jsx(Ie,{asChild:!0,children:e.jsx(y,{variant:"destructive",children:e.jsx(Te,{})})}),e.jsxs(Pe,{align:"end",className:"w-fit flex flex-col gap-2",children:[e.jsx(y,{variant:"outline",onClick:()=>l("profile"),children:"Supprimer la photo de profil"}),e.jsx(y,{variant:"outline",onClick:()=>l("cover"),children:"Supprimer la photo de couverture"})]})]})})]})}var $="Switch",[He,rt]=G($),[Oe,Ue]=He($),ne=n.forwardRef((t,r)=>{const{__scopeSwitch:s,name:a,checked:o,defaultChecked:c,required:l,disabled:i,value:d="on",onCheckedChange:x,...I}=t,[p,S]=n.useState(null),L=ve(r,h=>S(h)),j=n.useRef(!1),P=p?!!p.closest("form"):!0,[N=!1,E]=ge({prop:o,defaultProp:c,onChange:x});return e.jsxs(Oe,{scope:s,checked:N,disabled:i,children:[e.jsx(M.button,{type:"button",role:"switch","aria-checked":N,"aria-required":l,"data-state":de(N),"data-disabled":i?"":void 0,disabled:i,value:d,...I,ref:L,onClick:je(t.onClick,h=>{E(R=>!R),P&&(j.current=h.isPropagationStopped(),j.current||h.stopPropagation())})}),P&&e.jsx(De,{control:p,bubbles:!j.current,name:a,value:d,checked:N,required:l,disabled:i,style:{transform:"translateX(-100%)"}})]})});ne.displayName=$;var ce="SwitchThumb",ie=n.forwardRef((t,r)=>{const{__scopeSwitch:s,...a}=t,o=Ue(ce,s);return e.jsx(M.span,{"data-state":de(o.checked),"data-disabled":o.disabled?"":void 0,...a,ref:r})});ie.displayName=ce;var De=t=>{const{control:r,checked:s,bubbles:a=!0,...o}=t,c=n.useRef(null),l=be(s),i=ye(r);return n.useEffect(()=>{const d=c.current,x=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(x,"checked").set;if(l!==s&&p){const S=new Event("click",{bubbles:a});p.call(d,s),d.dispatchEvent(S)}},[l,s,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...o,tabIndex:-1,ref:c,style:{...t.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function de(t){return t?"checked":"unchecked"}var le=ne,Ge=ie;const B=n.forwardRef(({className:t,...r},s)=>e.jsx(le,{className:A("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...r,ref:s,children:e.jsx(Ge,{className:A("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));B.displayName=le.displayName;const We=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,Xe=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,Je=["image/jpeg","image/jpg","image/png"];function ot(){var H,O;const{auth:t}=Ne(),[r,s]=n.useState(t),[a,o]=n.useState({name:t.name,address:t.address,email:t.email,phoneNumber:t.phoneNumber,bookingTerms:t.bookingTerms,contactMethods:t.contactMethods,autoAcceptAppointments:t.autoAcceptAppointments,isInVacancyMode:t.isInVacancyMode,profilePicture:t.profilePicture,coverImage:t.coverImage}),[c,l]=n.useState(),[i,d]=n.useState(!1),[x,I]=n.useState(!1),p=Re(),S=we(),L=ke();async function j(){var u;try{const{data:m}=await p.get("/api/pro");return s(m),m}catch(m){l(m),((u=m.response)==null?void 0:u.status)===401&&S("/login",{state:{from:L},replace:!0})}}const P=async()=>{try{await p.delete("/api/users/profile",{profilePicture:null}),await j()}catch(u){console.log(u)}},N=async()=>{try{await p.delete("/api/users/cover",{coverImage:null}),await j()}catch(u){console.log(u)}},E=()=>{o({name:t.name,address:t.address,email:t.email,phoneNumber:t.phoneNumber,bookingTerms:t.bookingTerms,contactMethods:t.contactMethods,autoAcceptAppointments:t.autoAcceptAppointments,isInVacancyMode:t.isInVacancyMode,profilePicture:t.profilePicture,coverImage:t.coverImage})},h=u=>{const{id:m,name:g,value:v}=u.target;if(g==="contactMethod"){const b={...a.contactMethods,[m]:v};o({...a,contactMethods:b});return}o({...a,[m]:v})},R=async u=>{u.preventDefault(),d(!0);const{name:m,email:g,phoneNumber:v,contactMethods:b}=a;if(!m||!g||!v){f.error("Veuillez renseigner tous les champs obligatoires"),d(!1);return}const{contactMethods:Ke,...U}=a,{contactMethods:Qe,...ue}=r,me=Object.keys(U).some(w=>U[w]!==ue[w]),pe=Object.keys(b).some(w=>b[w]!==r.contactMethods[w]);if(!me&&!pe){f("Aucune modification effectuée"),d(!1);return}if(g&&!Xe.test(g)){f.error("L'adresse email n'est pas valide"),d(!1);return}if(v&&!We.test(v)){f.error("Le numéro de téléphone n'est pas valide"),d(!1);return}const he={...a};o(he);try{await p.patch("/api/pro",{...a}),f.success("Modifications enregistrées")}catch{E(),f.error("Une erreur est survenue, veuillez contacter le support")}d(!1)},q=async u=>{const{id:m,files:g}=u.target;Je.includes(g[0].type)||f.error("Le format du fichier n'est pas valide");const v=new FormData;v.append(m,g[0]);try{await p.post(`/api/s3/${m}`,v,{headers:{"Content-Type":"multipart/form-data"}}),j(),f.success("Photo de profil mise à jour avec succès")}catch(b){b.response.status===413?f.error("Le fichier est trop volumineux"):(console.error(b.response.data.message),f.error("Une erreur est survenue, veuillez contacter le support"))}};return c?e.jsx(ze,{errMsg:c}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col gap-4",children:[e.jsx(Ee,{children:e.jsxs(Le,{children:[e.jsx(_,{children:e.jsx(V,{asChild:!0,children:e.jsx(T,{to:"/",children:"Tableau de bord"})})}),e.jsx(D,{}),e.jsx(_,{children:e.jsx(V,{asChild:!0,children:e.jsx(T,{to:"/salon",children:"Salon"})})}),e.jsx(D,{}),e.jsx(_,{children:e.jsx(V,{asChild:!0,children:e.jsx(T,{to:"/salon/informations",children:"Informations"})})})]})}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsx(qe,{name:a.name,address:a.address,profilePicture:a.profilePicture,coverImage:a.coverImage,rmprofile:P,rmcover:N}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(y,{asChild:!0,children:e.jsx(C,{htmlFor:"profile",className:" w-full",children:"Changer ma photo de profil"})}),e.jsx(z,{className:"hidden",type:"file",id:"profile",onChange:q}),e.jsx(y,{asChild:!0,children:e.jsx(C,{htmlFor:"cover",className:" w-full",children:"Changer ma photo de couverture"})}),e.jsx(z,{className:"hidden",type:"file",id:"cover",onChange:q})]}),e.jsxs("form",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4 mb-8",children:[e.jsx(k,{id:"name",label:"Nom du salon",type:"text",defaultValue:a.name,handleChange:h}),e.jsx(k,{id:"address",label:"Adresse",type:"text",defaultValue:a.address,handleChange:h}),e.jsx(k,{id:"email",label:"Email",type:"email",defaultValue:a.email,handleChange:h}),e.jsx(k,{id:"phoneNumber",label:"Numéro de téléphone",type:"tel",defaultValue:a.phoneNumber,handleChange:h})]}),e.jsx("div",{className:"divider divider-start",children:e.jsx("p",{className:"text-muted",children:"Moyens de contact"})}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(k,{id:"instagram",name:"contactMethod",label:"Instagram",type:"text",defaultValue:(H=a.contactMethods)==null?void 0:H.instagram,placeholder:"@weconnect_off",handleChange:h}),e.jsx(k,{id:"snapchat",name:"contactMethod",label:"Snapchat",type:"text",defaultValue:(O=a.contactMethods)==null?void 0:O.snapchat,handleChange:h})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(B,{id:"autoAccept",checked:a.autoAcceptAppointments,onCheckedChange:u=>{o({...a,autoAcceptAppointments:u})}})]}),e.jsxs("p",{className:"text-muted",children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(B,{id:"vacancyMode",checked:a==null?void 0:a.isInVacancyMode,onCheckedChange:u=>{o({...a,isInVacancyMode:u})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:"text-muted",children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(C,{htmlFor:"terms",children:"Conditions de réservation"}),e.jsx(Se,{id:"bookingTerms",type:"text",defaultValue:a.bookingTerms,onChange:h,className:"text-lg whitespace-pre-line"})]}),x&&setTimeout(()=>I(null),1e4)&&e.jsx("p",{className:"text-destructive text-sm",children:x}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:R,disabled:i&&!0,children:i?e.jsx(Ce,{className:"animate-spin"}):"Enregistrer les modifications"}),e.jsx(y,{variant:"outline",type:"reset",onClick:E,children:"Annuler"})]})]})]})}export{ot as default};

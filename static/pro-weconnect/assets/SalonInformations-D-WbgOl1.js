import{c as me,j as e,I as B,f as G,r as o,P as M,g as pe,h as X,a as E,B as b,i as he,k as fe,l as xe,m as ve,n as ge,e as je,o as be,p as U,L as T,J as h}from"./index-BBgiAXnE.js";import{L as k,T as ye}from"./textarea-BBRKw1kK.js";import{g as Ne,P as we,a as Ce,b as ke}from"./popover-CceGkGQi.js";import{B as Se,a as Ae,b as _,c as z,d as D}from"./breadcrumb-DUkkx9Ru.js";import{u as Ee}from"./useAxiosPrivate-BQpVaO1A.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=me("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Pe=({id:a,name:r="",label:t,type:n,defaultValue:i,placeholder:d=null,handleChange:s})=>e.jsxs("div",{children:[e.jsx(k,{htmlFor:a,children:t}),e.jsx(B,{id:a,type:n,name:r,defaultValue:i,placeholder:d,onChange:s,className:"text-lg"})]}),C=Pe,Ie=()=>e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-3xl text-destructive",children:"Oops!"}),e.jsx("p",{children:"Une erreur s'est produite."})]}),Le=Ie;var V="Avatar",[Re,We]=G(V),[Te,J]=Re(V),K=o.forwardRef((a,r)=>{const{__scopeAvatar:t,...n}=a,[i,d]=o.useState("idle");return e.jsx(Te,{scope:t,imageLoadingStatus:i,onImageLoadingStatusChange:d,children:e.jsx(M.span,{...n,ref:r})})});K.displayName=V;var W="AvatarImage",Q=o.forwardRef((a,r)=>{const{__scopeAvatar:t,src:n,onLoadingStatusChange:i=()=>{},...d}=a,s=J(W,t),c=_e(n),l=pe(f=>{i(f),s.onImageLoadingStatusChange(f)});return X(()=>{c!=="idle"&&l(c)},[c,l]),c==="loaded"?e.jsx(M.img,{...d,ref:r,src:n}):null});Q.displayName=W;var Y="AvatarFallback",Z=o.forwardRef((a,r)=>{const{__scopeAvatar:t,delayMs:n,...i}=a,d=J(Y,t),[s,c]=o.useState(n===void 0);return o.useEffect(()=>{if(n!==void 0){const l=window.setTimeout(()=>c(!0),n);return()=>window.clearTimeout(l)}},[n]),s&&d.imageLoadingStatus!=="loaded"?e.jsx(M.span,{...i,ref:r}):null});Z.displayName=Y;function _e(a){const[r,t]=o.useState("idle");return X(()=>{if(!a){t("error");return}let n=!0;const i=new window.Image,d=s=>()=>{n&&t(s)};return t("loading"),i.onload=d("loaded"),i.onerror=d("error"),i.src=a,()=>{n=!1}},[a]),r}var ee=K,ae=Q,te=Z;const se=o.forwardRef(({className:a,...r},t)=>e.jsx(ee,{ref:t,className:E("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...r}));se.displayName=ee.displayName;const re=o.forwardRef(({className:a,...r},t)=>e.jsx(ae,{ref:t,className:E("aspect-square h-full w-full",a),...r}));re.displayName=ae.displayName;const ne=o.forwardRef(({className:a,...r},t)=>e.jsx(te,{ref:t,className:E("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...r}));ne.displayName=te.displayName;function ze({name:a,address:r,profilePicture:t,coverImage:n,rmprofile:i,rmcover:d}){const s=async c=>{try{c==="profile"&&await i(),c==="cover"&&await d()}catch(l){console.error(l)}};return e.jsxs("div",{className:"hero w-full aspect-video relative max-h-[40vh] sm:max-h-[20vh] rounded-md overflow-hidden",style:{backgroundImage:`url(${n&&n})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"hero-overlay bg-opacity-40"}),e.jsx("div",{className:"hero-content text-neutral-content mt-auto mr-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(se,{className:"w-16 h-16",children:[e.jsx(re,{src:t}),e.jsx(ne,{className:"text-2xl",children:a&&Ne(a)})]}),e.jsxs("div",{className:"ml-4 space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold bg-muted px-2 py-1 rounded-sm w-fit",children:a}),e.jsx("p",{className:"bg-muted px-2 py-1 rounded-sm w-fit",children:r})]})]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(we,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(b,{variant:"destructive",children:e.jsx(Me,{})})}),e.jsxs(ke,{align:"end",className:"w-fit flex flex-col gap-2",children:[e.jsx(b,{variant:"outline",onClick:()=>s("profile"),children:"Supprimer la photo de profil"}),e.jsx(b,{variant:"outline",onClick:()=>s("cover"),children:"Supprimer la photo de couverture"})]})]})})]})}var $="Switch",[Be,Qe]=G($),[Fe,Ve]=Be($),oe=o.forwardRef((a,r)=>{const{__scopeSwitch:t,name:n,checked:i,defaultChecked:d,required:s,disabled:c,value:l="on",onCheckedChange:f,...S}=a,[p,y]=o.useState(null),L=he(r,w=>y(w)),v=o.useRef(!1),P=p?!!p.closest("form"):!0,[N=!1,g]=fe({prop:i,defaultProp:d,onChange:f});return e.jsxs(Fe,{scope:t,checked:N,disabled:c,children:[e.jsx(M.button,{type:"button",role:"switch","aria-checked":N,"aria-required":s,"data-state":le(N),"data-disabled":c?"":void 0,disabled:c,value:l,...S,ref:L,onClick:xe(a.onClick,w=>{g(R=>!R),P&&(v.current=w.isPropagationStopped(),v.current||w.stopPropagation())})}),P&&e.jsx($e,{control:p,bubbles:!v.current,name:n,value:l,checked:N,required:s,disabled:c,style:{transform:"translateX(-100%)"}})]})});oe.displayName=$;var ce="SwitchThumb",ie=o.forwardRef((a,r)=>{const{__scopeSwitch:t,...n}=a,i=Ve(ce,t);return e.jsx(M.span,{"data-state":le(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:r})});ie.displayName=ce;var $e=a=>{const{control:r,checked:t,bubbles:n=!0,...i}=a,d=o.useRef(null),s=ve(t),c=ge(r);return o.useEffect(()=>{const l=d.current,f=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(f,"checked").set;if(s!==t&&p){const y=new Event("click",{bubbles:n});p.call(l,t),l.dispatchEvent(y)}},[s,t,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:d,style:{...a.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function le(a){return a?"checked":"unchecked"}var de=oe,qe=ie;const F=o.forwardRef(({className:a,...r},t)=>e.jsx(de,{className:E("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...r,ref:t,children:e.jsx(qe,{className:E("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));F.displayName=de.displayName;const He=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,Oe=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,Ue=["image/jpeg","image/jpg","image/png"];function Ye(){var H,O;const[a,r]=o.useState(),[t,n]=o.useState(),[i,d]=o.useState(!0),[s,c]=o.useState(),[l,f]=o.useState(),[S,p]=o.useState(!1),[y,L]=o.useState(!1),v=Ee(),P=je(),N=be();async function g(){var u;try{const{data:m}=await v.get("/api/pro");return r(m),m}catch(m){n(m),((u=m.response)==null?void 0:u.status)===401&&P("/login",{state:{from:N},replace:!0})}finally{d(!1)}}const w=async()=>{try{await v.delete("/api/users/profile",{profilePicture:null}),await g()}catch(u){console.log(u)}},R=async()=>{try{await v.delete("/api/users/cover",{coverImage:null}),await g()}catch(u){console.log(u)}};o.useEffect(()=>{async function u(){const m=await g();f(m.contactMethods)}u()},[]);const j=u=>{const{id:m,name:x,value:A}=u.target;if(x==="contactMethod"){f(I=>({...I,[m]:A}));return}c({...s,[m]:A})},ue=async u=>{if(u.preventDefault(),p(!0),!s&&!l){p(!1),h("Aucune modification n'a été effectuée");return}if(s&&!l&&!Object.keys(s).some(x=>s[x]!==a[x])){c(),p(!1),h("Aucune modification n'a été effectuée");return}if(l&&!s&&!Object.keys(l).some(x=>l[x]!==a.contactMethods[x])){f(a.contactMethods),p(!1),h("Aucune modification n'a été effectuée");return}if(l.phoneNumber&&!He.test(l.phoneNumber)){h.error("Le numéro de téléphone n'est pas valide"),p(!1);return}if(s.email&&!Oe.test(s.email)){h.error("L'adresse email n'est pas valide"),p(!1);return}try{await v.patch("/api/users",{...s,contactMethods:l}),await g(),h("Modifications enregistrées")}catch(m){m.response?h.error(m.response.data.message):h.error("Une erreur est survenue, veuillez contacter le support")}c(),p(!1)},q=async u=>{const{id:m,files:x}=u.target;Ue.includes(x[0].type)||h.error("Le format du fichier n'est pas valide");const A=new FormData;A.append(m,x[0]);try{await v.post(`/api/s3/${m}`,A,{headers:{"Content-Type":"multipart/form-data"}}),g(),h.success("Photo de profil mise à jour avec succès")}catch(I){I.response.status===413?h.error("Le fichier est trop volumineux"):(console.error(I.response.data.message),h.error("Une erreur est survenue, veuillez contacter le support"))}};return i?e.jsx(U,{className:"w-8 h-8 animate-spin flex-1"}):t?e.jsx(Le,{errMsg:t}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col gap-4",children:[e.jsx(Se,{children:e.jsxs(Ae,{children:[e.jsx(_,{children:e.jsx(z,{asChild:!0,children:e.jsx(T,{to:"/",children:"Tableau de bord"})})}),e.jsx(D,{}),e.jsx(_,{children:e.jsx(z,{asChild:!0,children:e.jsx(T,{to:"/salon",children:"Salon"})})}),e.jsx(D,{}),e.jsx(_,{children:e.jsx(z,{asChild:!0,children:e.jsx(T,{to:"/salon/informations",children:"Informations"})})})]})}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsx(ze,{name:a.name,address:a.address,profilePicture:a.profilePicture,coverImage:a.coverImage,rmprofile:w,rmcover:R}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(b,{asChild:!0,children:e.jsx(k,{htmlFor:"profile",className:" w-full",children:"Changer ma photo de profil"})}),e.jsx(B,{className:"hidden",type:"file",id:"profile",onChange:q}),e.jsx(b,{asChild:!0,children:e.jsx(k,{htmlFor:"cover",className:" w-full",children:"Changer ma photo de couverture"})}),e.jsx(B,{className:"hidden",type:"file",id:"cover",onChange:q})]}),e.jsxs("form",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4 mb-8",children:[e.jsx(C,{id:"name",label:"Nom du salon",type:"text",defaultValue:a.name,handleChange:j}),e.jsx(C,{id:"address",label:"Adresse",type:"text",defaultValue:a.address,handleChange:j}),e.jsx(C,{id:"email",label:"Email",type:"email",defaultValue:a.email,handleChange:j}),e.jsx(C,{id:"phoneNumber",label:"Numéro de téléphone",type:"tel",defaultValue:a.phoneNumber,handleChange:j})]}),e.jsx("div",{className:"divider divider-start",children:e.jsx("p",{className:"text-muted",children:"Moyens de contact"})}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(C,{id:"instagram",name:"contactMethod",label:"Instagram",type:"text",defaultValue:(H=a.contactMethods)==null?void 0:H.instagram,placeholder:"@weconnect_off",handleChange:j}),e.jsx(C,{id:"snapchat",name:"contactMethod",label:"Snapchat",type:"text",defaultValue:(O=a.contactMethods)==null?void 0:O.snapchat,handleChange:j})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(F,{id:"autoAccept",checked:(s==null?void 0:s.autoAcceptAppointments)??a.autoAcceptAppointments,onCheckedChange:u=>{c({...s,autoAcceptAppointments:u})}})]}),e.jsxs("p",{className:"text-muted",children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(F,{id:"vacancyMode",checked:(s==null?void 0:s.isInVacancyMode)??a.isInVacancyMode,onCheckedChange:u=>{c({...s,isInVacancyMode:u})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:"text-muted",children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(k,{htmlFor:"terms",children:"Conditions de réservation"}),e.jsx(ye,{id:"bookingTerms",type:"text",defaultValue:a.bookingTerms,onChange:j,className:"text-lg whitespace-pre-line"})]}),y&&setTimeout(()=>L(null),1e4)&&e.jsx("p",{className:"text-destructive text-sm",children:y}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{onClick:ue,disabled:S&&!0,children:S?e.jsx(U,{className:"animate-spin"}):"Enregistrer les modifications"}),e.jsx(b,{variant:"outline",type:"reset",onClick:()=>{c(),f(a.contactMethods)},children:"Annuler"})]})]})]})}export{Ye as default};

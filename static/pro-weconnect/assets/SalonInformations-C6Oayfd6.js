import{c as pe,j as e,f as G,r as n,P,g as xe,h as W,a as A,B as N,i as fe,k as ve,l as ge,m as je,n as ye,u as be,e as Ne,o as we,L as R,I as b,p as Ce,J as y}from"./index-DHBq4Dql.js";import{L as x,T as Se}from"./textarea-CGEpKktj.js";import{g as ke,P as Me,a as Ie,b as Ae}from"./popover-f5JcPCRM.js";import{B as Pe,a as Ee,b as B,c as F,d as D}from"./breadcrumb-BzCYkm77.js";import{u as Te}from"./useAxiosPrivate--BfgRu2g.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=pe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_e=()=>e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-3xl text-destructive",children:"Oops!"}),e.jsx("p",{children:"Une erreur s'est produite."})]}),Re=_e;var z="Avatar",[Be,Ze]=G(z),[Fe,X]=Be(z),J=n.forwardRef((a,r)=>{const{__scopeAvatar:t,...s}=a,[o,c]=n.useState("idle");return e.jsx(Fe,{scope:t,imageLoadingStatus:o,onImageLoadingStatusChange:c,children:e.jsx(P.span,{...s,ref:r})})});J.displayName=z;var K="AvatarImage",Q=n.forwardRef((a,r)=>{const{__scopeAvatar:t,src:s,onLoadingStatusChange:o=()=>{},...c}=a,l=X(K,t),i=Ue(s),m=xe(h=>{o(h),l.onImageLoadingStatusChange(h)});return W(()=>{i!=="idle"&&m(i)},[i,m]),i==="loaded"?e.jsx(P.img,{...c,ref:r,src:s}):null});Q.displayName=K;var Y="AvatarFallback",Z=n.forwardRef((a,r)=>{const{__scopeAvatar:t,delayMs:s,...o}=a,c=X(Y,t),[l,i]=n.useState(s===void 0);return n.useEffect(()=>{if(s!==void 0){const m=window.setTimeout(()=>i(!0),s);return()=>window.clearTimeout(m)}},[s]),l&&c.imageLoadingStatus!=="loaded"?e.jsx(P.span,{...o,ref:r}):null});Z.displayName=Y;function Ue(a){const[r,t]=n.useState("idle");return W(()=>{if(!a){t("error");return}let s=!0;const o=new window.Image,c=l=>()=>{s&&t(l)};return t("loading"),o.onload=c("loaded"),o.onerror=c("error"),o.src=a,()=>{s=!1}},[a]),r}var ee=J,se=Q,ae=Z;const te=n.forwardRef(({className:a,...r},t)=>e.jsx(ee,{ref:t,className:A("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...r}));te.displayName=ee.displayName;const re=n.forwardRef(({className:a,...r},t)=>e.jsx(se,{ref:t,className:A("aspect-square h-full w-full",a),...r}));re.displayName=se.displayName;const oe=n.forwardRef(({className:a,...r},t)=>e.jsx(ae,{ref:t,className:A("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...r}));oe.displayName=ae.displayName;function ze({name:a,address:r,profilePicture:t,coverImage:s,rmprofile:o,rmcover:c}){const l=async i=>{try{i==="profile"&&await o(),i==="cover"&&await c()}catch(m){console.error(m)}};return e.jsxs("div",{className:"hero w-full aspect-video relative max-h-[40vh] sm:max-h-[20vh] rounded-md overflow-hidden",style:{backgroundImage:`url(${s&&s})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"hero-overlay bg-opacity-40"}),e.jsx("div",{className:"hero-content text-neutral-content mt-auto mr-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(te,{className:"w-16 h-16",children:[e.jsx(re,{src:t}),e.jsx(oe,{className:"text-2xl",children:a&&ke(a)})]}),e.jsxs("div",{className:"ml-4 space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold bg-muted px-2 py-1 rounded-sm w-fit",children:a}),e.jsx("p",{className:"bg-muted px-2 py-1 rounded-sm w-fit",children:r})]})]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(Me,{children:[e.jsx(Ie,{asChild:!0,children:e.jsx(N,{variant:"destructive",children:e.jsx(Le,{})})}),e.jsxs(Ae,{align:"end",className:"w-fit flex flex-col gap-2",children:[e.jsx(N,{variant:"outline",onClick:()=>l("profile"),children:"Supprimer la photo de profil"}),e.jsx(N,{variant:"outline",onClick:()=>l("cover"),children:"Supprimer la photo de couverture"})]})]})})]})}var $="Switch",[$e,es]=G($),[Oe,He]=$e($),ne=n.forwardRef((a,r)=>{const{__scopeSwitch:t,name:s,checked:o,defaultChecked:c,required:l,disabled:i,value:m="on",onCheckedChange:h,...w}=a,[p,M]=n.useState(null),_=fe(r,S=>M(S)),I=n.useRef(!1),E=p?!!p.closest("form"):!0,[C=!1,v]=ve({prop:o,defaultProp:c,onChange:h});return e.jsxs(Oe,{scope:t,checked:C,disabled:i,children:[e.jsx(P.button,{type:"button",role:"switch","aria-checked":C,"aria-required":l,"data-state":le(C),"data-disabled":i?"":void 0,disabled:i,value:m,...w,ref:_,onClick:ge(a.onClick,S=>{v(T=>!T),E&&(I.current=S.isPropagationStopped(),I.current||S.stopPropagation())})}),E&&e.jsx(qe,{control:p,bubbles:!I.current,name:s,value:m,checked:C,required:l,disabled:i,style:{transform:"translateX(-100%)"}})]})});ne.displayName=$;var ce="SwitchThumb",ie=n.forwardRef((a,r)=>{const{__scopeSwitch:t,...s}=a,o=He(ce,t);return e.jsx(P.span,{"data-state":le(o.checked),"data-disabled":o.disabled?"":void 0,...s,ref:r})});ie.displayName=ce;var qe=a=>{const{control:r,checked:t,bubbles:s=!0,...o}=a,c=n.useRef(null),l=je(t),i=ye(r);return n.useEffect(()=>{const m=c.current,h=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(h,"checked").set;if(l!==t&&p){const M=new Event("click",{bubbles:s});p.call(m,t),m.dispatchEvent(M)}},[l,t,s]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...o,tabIndex:-1,ref:c,style:{...a.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function le(a){return a?"checked":"unchecked"}var de=ne,Ve=ie;const U=n.forwardRef(({className:a,...r},t)=>e.jsx(de,{className:A("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...r,ref:t,children:e.jsx(Ve,{className:A("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));U.displayName=de.displayName;const De=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,Ge=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,We=["image/jpeg","image/jpg","image/png"];function ss(){var O,H;const{auth:a}=be(),[r,t]=n.useState(),[s,o]=n.useState(),[c,l]=n.useState(),[i,m]=n.useState(),[h,w]=n.useState({SPLASH_SCREEN:!0,SUBMIT_BUTTON:!1}),p=Te(),M=Ne(),_=we();async function I(){var d;try{const{data:u}=await p.get("/api/pro"),{availabilities:g,providerCategories:f,...j}=u;t(j),o(j),l({profilePicture:u.profilePicture,coverImage:u.coverImage})}catch(u){m(u),((d=u.response)==null?void 0:d.status)===401&&M("/login",{state:{from:_},replace:!0})}finally{w({...h,SPLASH_SCREEN:!1})}}const E=async()=>{try{await p.delete("/api/s3/profile",{profilePicture:null}),l({...c,profilePicture:null})}catch(d){console.log(d)}},C=async()=>{try{await p.delete("/api/s3/cover",{coverImage:null}),l({...c,coverImage:null})}catch(d){console.log(d)}},v=d=>{const{id:u,name:g,value:f}=d.target;if(g==="contactMethod"){const j={...s.contactMethods,[u]:f};o({...s,contactMethods:j});return}o({...s,[u]:f})},S=async d=>{d.preventDefault();const{name:u,email:g,phoneNumber:f,contactMethods:j}=r;if(!u||!g||!f){y.error("Veuillez renseigner tous les champs obligatoires");return}const{contactMethods:q,...L}=s,{contactMethods:V,...ue}=r,me=Object.keys(L).some(k=>L[k]!==ue[k]),he=Object.keys(j).some(k=>j[k]!==r.contactMethods[k]);if(!me&&!he){y("Aucune modification effectuée");return}if(g&&!Ge.test(g)){y.error("L'adresse email n'est pas valide");return}if(f&&!De.test(f)){y.error("Le numéro de téléphone n'est pas valide");return}try{w({...h,SUBMIT_BUTTON:!0}),await p.patch("/api/pro",{...s}),y.success("Modifications enregistrées"),t(s)}catch{o(r),y.error("Une erreur est survenue, veuillez contacter le support")}finally{w({...h,SUBMIT_BUTTON:!1})}},T=async d=>{const{id:u,files:g}=d.target;if(!We.includes(g[0].type)){y.error("Le format du fichier n'est pas valide");return}const f=new FormData;f.append(u,g[0]);const j=u==="profile"?"profilePicture":"coverImage",q=u==="profile"?"profile-picture":"cover/cover-image",L=`https://wcntbucket.s3.eu-west-3.amazonaws.com/user-${a.id}/${q}`;try{await p.post(`/api/s3/${u}`,f,{headers:{"Content-Type":"multipart/form-data"}}),l({...c,[j]:`${L}?t=${new Date().getTime()}`}),y.success("Photo mise à jour avec succès")}catch(V){console.error(V.response.data.message),y.error("Une erreur est survenue, veuillez contacter le support")}};return n.useEffect(()=>{I()},[]),i?(console.log(i),e.jsx(Re,{errMsg:i})):h.SPLASH_SCREEN?e.jsx("div",{children:"Loading..."}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col gap-4",children:[e.jsx(Pe,{children:e.jsxs(Ee,{children:[e.jsx(B,{children:e.jsx(F,{asChild:!0,children:e.jsx(R,{to:"/",children:"Tableau de bord"})})}),e.jsx(D,{}),e.jsx(B,{children:e.jsx(F,{asChild:!0,children:e.jsx(R,{to:"/salon",children:"Salon"})})}),e.jsx(D,{}),e.jsx(B,{children:e.jsx(F,{asChild:!0,children:e.jsx(R,{to:"/salon/informations",children:"Informations"})})})]})}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsx(ze,{name:r.name,address:r.address,profilePicture:c.profilePicture,coverImage:c.coverImage,rmprofile:E,rmcover:C}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(N,{asChild:!0,children:e.jsx(x,{htmlFor:"profile",className:"w-full",children:"Changer ma photo de profil"})}),e.jsx(b,{className:"hidden",type:"file",id:"profile",onChange:T}),e.jsx(N,{asChild:!0,children:e.jsx(x,{htmlFor:"cover",className:"w-full",children:"Changer ma photo de couverture"})}),e.jsx(b,{className:"hidden",type:"file",id:"cover",onChange:T})]}),e.jsxs("form",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"name",children:"Nom du salon"}),e.jsx(b,{id:"name",type:"text",value:s==null?void 0:s.name,onChange:v,className:"text-lg"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"address",children:"Adresse"}),e.jsx(b,{id:"address",type:"text",value:s.address,onChange:v,className:"text-lg"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"phoneNumber",children:"Téléphone du salon"}),e.jsx(b,{id:"phoneNumber",type:"tel",value:s.phoneNumber,onChange:v,className:"text-lg"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsx(b,{id:"email",type:"email",value:s.email,onChange:v,className:"text-lg"})]})]}),e.jsx("div",{className:"divider divider-start",children:e.jsx("p",{className:"text-muted",children:"Moyens de contact"})}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"instagram",children:"Instagram"}),e.jsx(b,{id:"instagram",name:"contactMethod",type:"text",value:(O=s.contactMethods)==null?void 0:O.instagram,placeholder:"@weconnect_off",onChange:v,className:"text-lg"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"snapchat",children:"Snapchat"}),e.jsx(b,{id:"snapchat",name:"contactMethod",type:"text",value:(H=s.contactMethods)==null?void 0:H.snapchat,onChange:v,className:"text-lg"})]})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(U,{id:"autoAccept",checked:s.autoAcceptAppointments,onCheckedChange:d=>{o({...s,autoAcceptAppointments:d})}})]}),e.jsxs("p",{className:"text-muted",children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(U,{id:"vacancyMode",checked:s==null?void 0:s.isInVacancyMode,onCheckedChange:d=>{o({...s,isInVacancyMode:d})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:"text-muted",children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(x,{htmlFor:"terms",children:"Conditions de réservation"}),e.jsx(Se,{id:"bookingTerms",type:"text",defaultValue:s.bookingTerms,onChange:v,className:"text-lg whitespace-pre-line"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{onClick:S,disabled:h.SUBMIT_BUTTON,children:h.SUBMIT_BUTTON?e.jsx(Ce,{className:"animate-spin"}):"Enregistrer les modifications"}),e.jsx(N,{variant:"outline",type:"button",onClick:()=>o(r),children:"Annuler"})]})]})]})}export{ss as default};

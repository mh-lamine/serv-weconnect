import{c as ne,j as e,I as M,g as $,r as i,P as S,h as oe,i as q,a as C,B as y,k as ie,l as ce,m as le,n as de,o as ue,e as pe,f as me,p as he,q as fe,L as I,J as h}from"./index-BxPUNZLQ.js";import{L as w,T as xe}from"./textarea-bQx08svH.js";import{g as ve,P as ge,a as je,b as be}from"./popover-CtKc2c-G.js";import{B as ye,a as we,b as L,c as R,d as V}from"./breadcrumb-Bdgyfp2_.js";import"./index-80kTGRaO.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=ne("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ke=({id:a,name:r="",label:s,type:n,defaultValue:c,placeholder:o=null,handleChange:l})=>e.jsxs("div",{children:[e.jsx(w,{htmlFor:a,children:s}),e.jsx(M,{id:a,type:n,name:r,defaultValue:c,placeholder:o,onChange:l,className:"text-lg"})]}),E=ke,Ce=()=>e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-3xl text-destructive",children:"Oops!"}),e.jsx("p",{children:"Une erreur s'est produite."})]}),Se=Ce;var _="Avatar",[Ae,Oe]=$(_),[Ee,H]=Ae(_),U=i.forwardRef((a,r)=>{const{__scopeAvatar:s,...n}=a,[c,o]=i.useState("idle");return e.jsx(Ee,{scope:s,imageLoadingStatus:c,onImageLoadingStatusChange:o,children:e.jsx(S.span,{...n,ref:r})})});U.displayName=_;var O="AvatarImage",D=i.forwardRef((a,r)=>{const{__scopeAvatar:s,src:n,onLoadingStatusChange:c=()=>{},...o}=a,l=H(O,s),d=Pe(n),t=oe(p=>{c(p),l.onImageLoadingStatusChange(p)});return q(()=>{d!=="idle"&&t(d)},[d,t]),d==="loaded"?e.jsx(S.img,{...o,ref:r,src:n}):null});D.displayName=O;var G="AvatarFallback",X=i.forwardRef((a,r)=>{const{__scopeAvatar:s,delayMs:n,...c}=a,o=H(G,s),[l,d]=i.useState(n===void 0);return i.useEffect(()=>{if(n!==void 0){const t=window.setTimeout(()=>d(!0),n);return()=>window.clearTimeout(t)}},[n]),l&&o.imageLoadingStatus!=="loaded"?e.jsx(S.span,{...c,ref:r}):null});X.displayName=G;function Pe(a){const[r,s]=i.useState("idle");return q(()=>{if(!a){s("error");return}let n=!0;const c=new window.Image,o=l=>()=>{n&&s(l)};return s("loading"),c.onload=o("loaded"),c.onerror=o("error"),c.src=a,()=>{n=!1}},[a]),r}var J=U,K=D,W=X;const Q=i.forwardRef(({className:a,...r},s)=>e.jsx(J,{ref:s,className:C("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...r}));Q.displayName=J.displayName;const Y=i.forwardRef(({className:a,...r},s)=>e.jsx(K,{ref:s,className:C("aspect-square h-full w-full",a),...r}));Y.displayName=K.displayName;const Z=i.forwardRef(({className:a,...r},s)=>e.jsx(W,{ref:s,className:C("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...r}));Z.displayName=W.displayName;function Ie({name:a,address:r,profilePicture:s,coverImage:n,rmprofile:c,rmcover:o}){const l=async d=>{try{d==="profile"&&await c(),d==="cover"&&await o()}catch(t){console.error(t)}};return e.jsxs("div",{className:"hero w-full aspect-video relative max-h-[40vh] sm:max-h-[20vh] rounded-md overflow-hidden",style:{backgroundImage:`url("${n&&n}")`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"hero-overlay bg-opacity-40"}),e.jsx("div",{className:"hero-content text-neutral-content mt-auto mr-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(Q,{className:"w-16 h-16",children:[e.jsx(Y,{src:s}),e.jsx(Z,{className:"text-2xl",children:a&&ve(a)})]}),e.jsxs("div",{className:"ml-4 space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold bg-muted px-2 py-1 rounded-sm w-fit",children:a}),e.jsx("p",{className:"bg-muted px-2 py-1 rounded-sm w-fit",children:r})]})]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(ge,{children:[e.jsx(je,{asChild:!0,children:e.jsx(y,{variant:"destructive",children:e.jsx(Ne,{})})}),e.jsxs(be,{align:"end",className:"w-fit flex flex-col gap-2",children:[e.jsx(y,{variant:"outline",onClick:()=>l("profile"),children:"Supprimer la photo de profil"}),e.jsx(y,{variant:"outline",onClick:()=>l("cover"),children:"Supprimer la photo de couverture"})]})]})})]})}var F="Switch",[Le,De]=$(F),[Re,Me]=Le(F),ee=i.forwardRef((a,r)=>{const{__scopeSwitch:s,name:n,checked:c,defaultChecked:o,required:l,disabled:d,value:t="on",onCheckedChange:p,...v}=a,[g,N]=i.useState(null),j=ie(r,b=>N(b)),k=i.useRef(!1),A=g?!!g.closest("form"):!0,[f=!1,P]=ce({prop:c,defaultProp:o,onChange:p});return e.jsxs(Re,{scope:s,checked:f,disabled:d,children:[e.jsx(S.button,{type:"button",role:"switch","aria-checked":f,"aria-required":l,"data-state":te(f),"data-disabled":d?"":void 0,disabled:d,value:t,...v,ref:j,onClick:le(a.onClick,b=>{P(u=>!u),A&&(k.current=b.isPropagationStopped(),k.current||b.stopPropagation())})}),A&&e.jsx(Te,{control:g,bubbles:!k.current,name:n,value:t,checked:f,required:l,disabled:d,style:{transform:"translateX(-100%)"}})]})});ee.displayName=F;var ae="SwitchThumb",se=i.forwardRef((a,r)=>{const{__scopeSwitch:s,...n}=a,c=Me(ae,s);return e.jsx(S.span,{"data-state":te(c.checked),"data-disabled":c.disabled?"":void 0,...n,ref:r})});se.displayName=ae;var Te=a=>{const{control:r,checked:s,bubbles:n=!0,...c}=a,o=i.useRef(null),l=de(s),d=ue(r);return i.useEffect(()=>{const t=o.current,p=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(p,"checked").set;if(l!==s&&g){const N=new Event("click",{bubbles:n});g.call(t,s),t.dispatchEvent(N)}},[l,s,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...c,tabIndex:-1,ref:o,style:{...a.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function te(a){return a?"checked":"unchecked"}var re=ee,_e=se;const T=i.forwardRef(({className:a,...r},s)=>e.jsx(re,{className:C("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...r,ref:s,children:e.jsx(_e,{className:C("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));T.displayName=re.displayName;const Fe=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,ze=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,Be=["image/jpeg","image/jpg","image/png"];function Ge(){const[a,r]=i.useState(),[s,n]=i.useState(),[c,o]=i.useState(!1),[l,d]=i.useState(!0),[t,p]=i.useState(),v=pe(),g=me(),N=he();async function j(){var u;try{const{data:m}=await v.get("/api/salon");return r(m),m}catch(m){n(m),((u=m.response)==null?void 0:u.status)===401&&g("/login",{state:{from:N},replace:!0})}finally{d(!1)}}const k=async()=>{try{await v.delete("/api/s3/profile",{profilePicture:null}),await j()}catch(u){console.log(u)}},A=async()=>{try{await v.delete("/api/s3/cover",{coverImage:null}),await j()}catch(u){console.log(u)}};i.useEffect(()=>{j()},[]);const f=u=>{const{id:m,value:x}=u.target;p({...t,[m]:x})},P=async u=>{if(u.preventDefault(),o(!0),!t){o(!1),h("Aucune modification n'a été effectuée");return}if(!Object.keys(t).some(x=>t[x]!==a[x])){p(),o(!1),h("Aucune modification n'a été effectuée");return}if(t.phoneNumber&&!Fe.test(t.phoneNumber)){h.error("Le numéro de téléphone n'est pas valide"),o(!1);return}if(t.email&&!ze.test(t.email)){h.error("L'adresse email n'est pas valide"),o(!1);return}try{await v.patch("/api/salon",{...t}),await j(),h("Modifications enregistrées")}catch(x){x.response?h.error(x.response.data.message):h.error("Une erreur est survenue, veuillez contacter le support")}p(),o(!1)},b=async u=>{const{id:m,files:x}=u.target;Be.includes(x[0].type)||h.error("Le format du fichier n'est pas valide");const z=new FormData;z.append(m,x[0]);try{await v.post(`/api/s3/${m}`,z,{headers:{"Content-Type":"multipart/form-data"}}),j(),h.success("Photo de profil mise à jour avec succès")}catch(B){B.response.status===413?h.error("Le fichier est trop volumineux"):(console.error(B.response.data.message),h.error("Une erreur est survenue, veuillez contacter le support"))}};return l?e.jsx(fe,{className:"w-8 h-8 animate-spin flex-1"}):s?e.jsx(Se,{errMsg:s}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col gap-4",children:[e.jsx(ye,{children:e.jsxs(we,{children:[e.jsx(L,{children:e.jsx(R,{asChild:!0,children:e.jsx(I,{to:"/",children:"Tableau de bord"})})}),e.jsx(V,{}),e.jsx(L,{children:e.jsx(R,{asChild:!0,children:e.jsx(I,{to:"/salon",children:"Salon"})})}),e.jsx(V,{}),e.jsx(L,{children:e.jsx(R,{asChild:!0,children:e.jsx(I,{to:"/salon/informations",children:"Informations"})})})]})}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsx(Ie,{name:a.name,address:a.address,profilePicture:a.profilePicture,coverImage:a.coverImage,rmprofile:k,rmcover:A}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(y,{asChild:!0,children:e.jsx(w,{htmlFor:"profile",className:" w-full",children:"Changer ma photo de profil"})}),e.jsx(M,{className:"hidden",type:"file",id:"profile",onChange:b}),e.jsx(y,{asChild:!0,children:e.jsx(w,{htmlFor:"cover",className:" w-full",children:"Changer ma photo de couverture"})}),e.jsx(M,{className:"hidden",type:"file",id:"cover",onChange:b})]}),e.jsxs("form",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(E,{id:"name",label:"Nom du salon",type:"text",defaultValue:a.name,handleChange:f}),e.jsx(E,{id:"address",label:"Adresse",type:"text",defaultValue:a.address,handleChange:f}),e.jsx(E,{id:"phoneNumber",label:"Téléphone du salon",type:"tel",defaultValue:a.phoneNumber,handleChange:f}),e.jsx(E,{id:"email",label:"Email",type:"email",defaultValue:a.email,handleChange:f})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(T,{id:"autoAccept",checked:(t==null?void 0:t.autoAcceptAppointments)??a.autoAcceptAppointments,onCheckedChange:u=>{p({...t,autoAcceptAppointments:u})}})]}),e.jsxs("p",{className:"text-muted",children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(T,{id:"vacancyMode",checked:(t==null?void 0:t.isInVacancyMode)??a.isInVacancyMode,onCheckedChange:u=>{p({...t,isInVacancyMode:u})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:"text-muted",children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(w,{htmlFor:"terms",children:"Conditions de réservation"}),e.jsx(xe,{id:"bookingTerms",type:"text",defaultValue:a.bookingTerms,onChange:f,className:"text-lg whitespace-pre-line"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:P,disabled:c,children:"Enregistrer les modifications"}),e.jsx(y,{variant:"outline",type:"reset",onClick:()=>{p()},children:"Annuler"})]})]})]})}export{Ge as default};

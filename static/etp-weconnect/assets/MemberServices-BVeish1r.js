import{r as l,j as e,B as u,a2 as D,a3 as y,a4 as k,a5 as A,a6 as M,x as L,J as B,F as z,e as P,g as T,h as V,i as f,k as g,L as v,m as b}from"./index-B1QHrCHD.js";import{M as E}from"./ModalAction-CTJ2hjHs.js";import{u as F,D as R,a as $,b as O,c as H,d as I,j as J,k as Q,l as U,e as q,f as G,g as K,h as W,i as X,m as Y,n as Z,o as _}from"./drawer-NP4VIGUB.js";import{C as ee}from"./circle-minus-CH_RXdiR.js";import"./Combination-PVGnqS30.js";const se=({categories:r,assignServices:w,member:x})=>{const[h,j]=l.useState(!1),[c,n]=l.useState(),[o,d]=l.useState(),[m,p]=l.useState(!1),C=F("(min-width: 768px)"),{firstName:i,lastName:a}=x,S=async s=>{if(s.preventDefault(),!o.length){B.error("Veuillez sélectionner des prestations.");return}p(!0);try{await w(o),n(),j(!1)}catch{B.error("Une erreur est survenue, veuillez contacter le support.")}p(!1)};return l.useEffect(()=>{d(x.services.map(s=>s.id))},[h]),C?e.jsxs(R,{open:h,onOpenChange:j,children:[e.jsx($,{asChild:!0,children:e.jsx(u,{variant:"link",className:"py-0",children:"Assigner des prestations"})}),e.jsxs(O,{className:"sm:max-w-[425px]",children:[e.jsxs(H,{children:[e.jsxs(I,{children:["Assigner des prestations à ",i," ",a]}),e.jsx(J,{children:"Sélectionnez une catégorie et ajoutez des prestations pour votre membre."})]}),e.jsxs(D,{value:c,onValueChange:n,children:[e.jsx(y,{className:"w-[180px]",children:e.jsx(k,{placeholder:"Sélectionner"})}),e.jsx(A,{children:r.map(s=>e.jsx(M,{value:s.id,children:s.name},s.id))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c&&r.find(s=>s.id===c).services.map(s=>e.jsx(u,{className:"w-fit",variant:o.find(t=>t===s.id)?"default":"outline",onClick:()=>d(t=>t.includes(s.id)?t.filter(N=>N!==s.id):[...t,s.id]),children:s.name},s.id))}),e.jsx(Q,{className:"sm:justify-start",children:e.jsx(U,{asChild:!0,children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx(u,{variant:"outline",onClick:()=>{d(x.services.map(s=>s.id)),n()},children:"Annuler"}),e.jsx(u,{onClick:S,disabled:m&&!0,children:m?e.jsx(L,{className:"animate-spin"}):"Ajouter"})]})})})]})]}):e.jsxs(q,{open:h,onOpenChange:j,children:[e.jsx(G,{asChild:!0,children:e.jsx(u,{variant:"link",children:"Assigner des prestations"})}),e.jsxs(K,{children:[e.jsxs(W,{children:[e.jsxs(X,{children:["Assigner des prestations à ",i," ",a]}),e.jsx(Y,{children:"Sélectionnez une catégorie et ajoutez des prestations pour votre membre."})]}),e.jsx("div",{className:"px-4 pb-2",children:e.jsxs(D,{value:c,onValueChange:n,children:[e.jsx(y,{className:"w-[180px]",children:e.jsx(k,{placeholder:"Sélectionner"})}),e.jsx(A,{children:r.map(s=>e.jsx(M,{value:s.id,children:s.name},s.id))})]})}),e.jsx("div",{className:"flex flex-wrap gap-2 px-4",children:c&&r.find(s=>s.id===c).services.map(s=>e.jsx(u,{className:"w-fit",variant:o.find(t=>t===s.id)?"default":"outline",onClick:()=>d(t=>t.includes(s.id)?t.filter(N=>N!==s.id):[...t,s.id]),children:s.name},s.id))}),e.jsx(Z,{className:"pt-2",children:e.jsx(_,{asChild:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"w-full",onClick:S,disabled:m&&!0,children:m?e.jsx(L,{className:"animate-spin"}):"Ajouter"}),e.jsx(u,{className:"w-full",variant:"outline",onClick:()=>{d(x.services.map(s=>s.id)),n()},children:"Annuler"})]})})})]})]})},ae=se;function ce(){const[r,w]=l.useState(),[x,h]=l.useState(),[j,c]=l.useState(!0),{id:n}=z(),o=P();async function d(){var i;try{const{data:a}=await o.get(`/api/salon/members/${n}`);w(a)}catch(a){console.error(a),((i=a.response)==null?void 0:i.status)===401&&navigate("/login",{state:{from:location},replace:!0})}}async function m(){var i;try{const{data:a}=await o.get("/api/providerCategory/me");h(a)}catch(a){console.error(a),((i=a.response)==null?void 0:i.status)===401&&navigate("/login",{state:{from:location},replace:!0})}}async function p(i){var a;try{await o.patch(`/api/salon/members/${n}/assign`,i),d()}catch{console.error(error),((a=error.response)==null?void 0:a.status)===401&&navigate("/login",{state:{from:location},replace:!0})}}async function C(i){p(r.services.map(a=>a.id).filter(a=>a!==i))}return l.useEffect(()=>{async function i(){await d(),await m(),c(!1)}i()},[]),j?e.jsx("div",{children:"Loading..."}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col space-y-4",children:[e.jsx(T,{children:e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(g,{asChild:!0,children:e.jsx(v,{to:"/",children:"Tableau de bord"})})}),e.jsx(b,{}),e.jsx(f,{children:e.jsx(g,{asChild:!0,children:e.jsx(v,{to:"/salon",children:"Salon"})})}),e.jsx(b,{}),e.jsx(f,{children:e.jsx(g,{asChild:!0,children:e.jsx(v,{to:"/salon/members",children:"Membres"})})}),e.jsx(b,{}),e.jsx(f,{children:e.jsx(g,{asChild:!0,children:e.jsx(v,{to:`/salon/members/${n}/services`,children:"Prestations"})})})]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-semibold",children:[r.firstName," ",r.lastName]}),e.jsx(ae,{categories:x,assignServices:p,member:r})]}),r.services.length?e.jsx("ul",{className:"space-y-2",children:r.services.map((i,a)=>e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("p",{children:i.name}),e.jsx(E,{id:i.id,action:C,actionLabel:"Retirer",title:"Retirer prestation",description:"Retirer cette prestation au membre.",successMessage:"Prestation retirée avec succès.",trigger:e.jsx(ee,{className:"text-destructive"}),variant:"destructive",triggerVariant:"outline"},i.id)]},i.id),a!==r.services.length-1&&e.jsx("div",{className:"divider"},a)]}))}):e.jsx("p",{className:"text-muted",children:"Ce membre n'a pas de prestations."})]})}export{ce as default};

import{r as l,j as e,B as m,p as D,J as y,s as z,L as f}from"./index-Bl2J71mt.js";import{M as P}from"./ModalAction-NwBS3T6K.js";import{u as T,D as V,a as E,b as R,c as $,d as F,j as O,k as H,l as I,e as J,f as Q,g as U,h as q,i as G,m as K,n as W,o as X}from"./drawer-D-nKjXOk.js";import{S as k,a as A,b as M,c as L,e as B}from"./select-LWxUqSsO.js";import{B as Y,a as Z,b as g,c as v,d as N}from"./breadcrumb-D9DQq-N1.js";import{u as _}from"./useAxiosPrivate-DMzzpoUa.js";import{C as ee}from"./circle-minus-BORrijMD.js";import"./axiosPrivate-DqHncTDW.js";import"./index-D3QsoVIf.js";import"./chevron-down-DZ_GVv6t.js";const se=({categories:i,assignServices:w,member:u})=>{const[h,j]=l.useState(!1),[c,n]=l.useState(),[o,d]=l.useState(),[x,p]=l.useState(!1),C=T("(min-width: 768px)"),{firstName:r,lastName:a}=u,S=async s=>{if(s.preventDefault(),!o.length){y.error("Veuillez sélectionner des prestations.");return}p(!0);try{await w(o),n(),j(!1)}catch{y.error("Une erreur est survenue, veuillez contacter le support.")}p(!1)};return l.useEffect(()=>{d(u.services.map(s=>s.id))},[h]),C?e.jsxs(V,{open:h,onOpenChange:j,children:[e.jsx(E,{asChild:!0,children:e.jsx(m,{variant:"link",className:"py-0",children:"Assigner des prestations"})}),e.jsxs(R,{className:"sm:max-w-[425px]",children:[e.jsxs($,{children:[e.jsxs(F,{children:["Assigner des prestations à ",r," ",a]}),e.jsx(O,{children:"Sélectionnez une catégorie et ajoutez des prestations pour votre membre."})]}),e.jsxs(k,{value:c,onValueChange:n,children:[e.jsx(A,{className:"w-[180px]",children:e.jsx(M,{placeholder:"Sélectionner"})}),e.jsx(L,{children:i.map(s=>e.jsx(B,{value:s.id,children:s.name},s.id))})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c&&i.find(s=>s.id===c).services.map(s=>e.jsx(m,{className:"w-fit",variant:o.find(t=>t===s.id)?"default":"outline",onClick:()=>d(t=>t.includes(s.id)?t.filter(b=>b!==s.id):[...t,s.id]),children:s.name},s.id))}),e.jsx(H,{className:"sm:justify-start",children:e.jsx(I,{asChild:!0,children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx(m,{variant:"outline",onClick:()=>{d(u.services.map(s=>s.id)),n()},children:"Annuler"}),e.jsx(m,{onClick:S,disabled:x&&!0,children:x?e.jsx(D,{className:"animate-spin"}):"Ajouter"})]})})})]})]}):e.jsxs(J,{open:h,onOpenChange:j,children:[e.jsx(Q,{asChild:!0,children:e.jsx(m,{variant:"link",children:"Assigner des prestations"})}),e.jsxs(U,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Assigner des prestations à ",r," ",a]}),e.jsx(K,{children:"Sélectionnez une catégorie et ajoutez des prestations pour votre membre."})]}),e.jsx("div",{className:"px-4 pb-2",children:e.jsxs(k,{value:c,onValueChange:n,children:[e.jsx(A,{className:"w-[180px]",children:e.jsx(M,{placeholder:"Sélectionner"})}),e.jsx(L,{children:i.map(s=>e.jsx(B,{value:s.id,children:s.name},s.id))})]})}),e.jsx("div",{className:"flex flex-wrap gap-2 px-4",children:c&&i.find(s=>s.id===c).services.map(s=>e.jsx(m,{className:"w-fit",variant:o.find(t=>t===s.id)?"default":"outline",onClick:()=>d(t=>t.includes(s.id)?t.filter(b=>b!==s.id):[...t,s.id]),children:s.name},s.id))}),e.jsx(W,{className:"pt-2",children:e.jsx(X,{asChild:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"w-full",onClick:S,disabled:x&&!0,children:x?e.jsx(D,{className:"animate-spin"}):"Ajouter"}),e.jsx(m,{className:"w-full",variant:"outline",onClick:()=>{d(u.services.map(s=>s.id)),n()},children:"Annuler"})]})})})]})]})},ae=se;function xe(){const[i,w]=l.useState(),[u,h]=l.useState(),[j,c]=l.useState(!0),{id:n}=z(),o=_();async function d(){var r;try{const{data:a}=await o.get(`/api/salon/members/${n}`);w(a)}catch(a){console.error(a),((r=a.response)==null?void 0:r.status)===401&&navigate("/login",{state:{from:location},replace:!0})}}async function x(){var r;try{const{data:a}=await o.get("/api/providerCategory/me");h(a)}catch(a){console.error(a),((r=a.response)==null?void 0:r.status)===401&&navigate("/login",{state:{from:location},replace:!0})}}async function p(r){var a;try{await o.patch(`/api/salon/members/${n}/assign`,r),d()}catch{console.error(error),((a=error.response)==null?void 0:a.status)===401&&navigate("/login",{state:{from:location},replace:!0})}}async function C(r){p(i.services.map(a=>a.id).filter(a=>a!==r))}return l.useEffect(()=>{async function r(){await d(),await x(),c(!1)}r()},[]),j?e.jsx("div",{children:"Loading..."}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col space-y-4",children:[e.jsx(Y,{children:e.jsxs(Z,{children:[e.jsx(g,{children:e.jsx(v,{asChild:!0,children:e.jsx(f,{to:"/",children:"Tableau de bord"})})}),e.jsx(N,{}),e.jsx(g,{children:e.jsx(v,{asChild:!0,children:e.jsx(f,{to:"/salon",children:"Salon"})})}),e.jsx(N,{}),e.jsx(g,{children:e.jsx(v,{asChild:!0,children:e.jsx(f,{to:"/salon/members",children:"Membres"})})}),e.jsx(N,{}),e.jsx(g,{children:e.jsx(v,{asChild:!0,children:e.jsx(f,{to:`/salon/members/${n}/services`,children:"Prestations"})})})]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-semibold",children:[i.firstName," ",i.lastName]}),e.jsx(ae,{categories:u,assignServices:p,member:i})]}),i.services.length?e.jsx("ul",{className:"space-y-2",children:i.services.map((r,a)=>e.jsxs(e.Fragment,{children:[e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("p",{children:r.name}),e.jsx(P,{id:r.id,action:C,actionLabel:"Retirer",title:"Retirer prestation",description:"Retirer cette prestation au membre.",successMessage:"Prestation retirée avec succès.",trigger:e.jsx(ee,{className:"text-destructive"}),variant:"destructive",triggerVariant:"outline"},r.id)]},r.id),a!==i.services.length-1&&e.jsx("div",{className:"divider"},a)]}))}):e.jsx("p",{className:"text-muted",children:"Ce membre n'a pas de prestations."})]})}export{xe as default};

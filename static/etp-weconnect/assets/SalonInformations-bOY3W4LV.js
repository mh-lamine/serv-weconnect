import{c as O,j as e,B as y,g as D,r as o,h as X,i as G,P as V,k as J,l as W,m as K,a as R,e as Q,f as Y,n as Z,o as ee,L as E,I as B,J as u}from"./index-CZTxtg5E.js";import{E as S}from"./EditableInput-CUvo_IQo.js";import{A as se,a as te,b as ae}from"./avatar-DqiB2wgH.js";import{g as re}from"./formatting-Cw3qGvmM.js";import{P as ne,a as oe,b as ie}from"./popover-C0rCYO_U.js";import{B as ce,a as le,b as A,c as I,d as F}from"./breadcrumb-ciRXjtt8.js";import{L as N}from"./label-ladyaj3b.js";import{T as de}from"./textarea-fPKd6RWw.js";import"./index-Bv2mp-7b.js";import"./index-C1cVRDRG.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=O("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),pe=()=>e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-3xl text-destructive",children:"Oops!"}),e.jsx("p",{children:"Une erreur s'est produite."})]}),me=pe;function he({name:s,address:i,profilePicture:r,coverImage:c,rmprofile:p,rmcover:n}){const m=async l=>{try{l==="profile"&&await p(),l==="cover"&&await n()}catch(t){console.error(t)}};return e.jsxs("div",{className:"hero w-full aspect-video relative max-h-[40vh] sm:max-h-[20vh] rounded-md overflow-hidden",style:{backgroundImage:`url("${c&&c}")`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"hero-overlay bg-opacity-40"}),e.jsx("div",{className:"hero-content text-neutral-content mt-auto mr-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(se,{className:"w-16 h-16",children:[e.jsx(te,{src:r}),e.jsx(ae,{className:"text-2xl",children:s&&re(s)})]}),e.jsxs("div",{className:"ml-4 space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold bg-muted px-2 py-1 rounded-sm w-fit",children:s}),e.jsx("p",{className:"bg-muted px-2 py-1 rounded-sm w-fit",children:i})]})]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(ne,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(y,{variant:"destructive",children:e.jsx(ue,{})})}),e.jsxs(ie,{align:"end",className:"w-fit flex flex-col gap-2",children:[e.jsx(y,{variant:"outline",onClick:()=>m("profile"),children:"Supprimer la photo de profil"}),e.jsx(y,{variant:"outline",onClick:()=>m("cover"),children:"Supprimer la photo de couverture"})]})]})})]})}var T="Switch",[fe,Le]=D(T),[xe,ve]=fe(T),_=o.forwardRef((s,i)=>{const{__scopeSwitch:r,name:c,checked:p,defaultChecked:n,required:m,disabled:l,value:t="on",onCheckedChange:h,...v}=s,[j,w]=o.useState(null),g=X(i,b=>w(b)),k=o.useRef(!1),C=j?!!j.closest("form"):!0,[f=!1,P]=G({prop:p,defaultProp:n,onChange:h});return e.jsxs(xe,{scope:r,checked:f,disabled:l,children:[e.jsx(V.button,{type:"button",role:"switch","aria-checked":f,"aria-required":m,"data-state":U(f),"data-disabled":l?"":void 0,disabled:l,value:t,...v,ref:g,onClick:J(s.onClick,b=>{P(a=>!a),C&&(k.current=b.isPropagationStopped(),k.current||b.stopPropagation())})}),C&&e.jsx(je,{control:j,bubbles:!k.current,name:c,value:t,checked:f,required:m,disabled:l,style:{transform:"translateX(-100%)"}})]})});_.displayName=T;var H="SwitchThumb",q=o.forwardRef((s,i)=>{const{__scopeSwitch:r,...c}=s,p=ve(H,r);return e.jsx(V.span,{"data-state":U(p.checked),"data-disabled":p.disabled?"":void 0,...c,ref:i})});q.displayName=H;var je=s=>{const{control:i,checked:r,bubbles:c=!0,...p}=s,n=o.useRef(null),m=W(r),l=K(i);return o.useEffect(()=>{const t=n.current,h=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(h,"checked").set;if(m!==r&&j){const w=new Event("click",{bubbles:c});j.call(t,r),t.dispatchEvent(w)}},[m,r,c]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...p,tabIndex:-1,ref:n,style:{...s.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function U(s){return s?"checked":"unchecked"}var $=_,ge=q;const M=o.forwardRef(({className:s,...i},r)=>e.jsx($,{className:R("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...i,ref:r,children:e.jsx(ge,{className:R("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));M.displayName=$.displayName;const be=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,ye=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,we=["image/jpeg","image/jpg","image/png"];function ze(){const[s,i]=o.useState(),[r,c]=o.useState(),[p,n]=o.useState(!1),[m,l]=o.useState(!0),[t,h]=o.useState(),v=Q(),j=Y(),w=Z();async function g(){var a;try{const{data:d}=await v.get("/api/salon");return i(d),d}catch(d){c(d),((a=d.response)==null?void 0:a.status)===401&&j("/login",{state:{from:w},replace:!0})}finally{l(!1)}}const k=async()=>{try{await v.delete("/api/s3/profile",{profilePicture:null}),await g()}catch(a){console.log(a)}},C=async()=>{try{await v.delete("/api/s3/cover",{coverImage:null}),await g()}catch(a){console.log(a)}};o.useEffect(()=>{g()},[]);const f=a=>{const{id:d,value:x}=a.target;h({...t,[d]:x})},P=async a=>{if(a.preventDefault(),n(!0),!t){n(!1),u("Aucune modification n'a été effectuée");return}if(!Object.keys(t).some(x=>t[x]!==s[x])){h(),n(!1),u("Aucune modification n'a été effectuée");return}if(t.phoneNumber&&!be.test(t.phoneNumber)){u.error("Le numéro de téléphone n'est pas valide"),n(!1);return}if(t.email&&!ye.test(t.email)){u.error("L'adresse email n'est pas valide"),n(!1);return}try{await v.patch("/api/salon",{...t}),await g(),u("Modifications enregistrées")}catch(x){x.response?u.error(x.response.data.message):u.error("Une erreur est survenue, veuillez contacter le support")}h(),n(!1)},b=async a=>{const{id:d,files:x}=a.target;we.includes(x[0].type)||u.error("Le format du fichier n'est pas valide");const L=new FormData;L.append(d,x[0]);try{await v.post(`/api/s3/${d}`,L,{headers:{"Content-Type":"multipart/form-data"}}),g(),u.success("Photo de profil mise à jour avec succès")}catch(z){z.response.status===413?u.error("Le fichier est trop volumineux"):(console.error(z.response.data.message),u.error("Une erreur est survenue, veuillez contacter le support"))}};return m?e.jsx(ee,{className:"w-8 h-8 animate-spin flex-1"}):r?e.jsx(me,{errMsg:r}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col gap-4",children:[e.jsx(ce,{children:e.jsxs(le,{children:[e.jsx(A,{children:e.jsx(I,{asChild:!0,children:e.jsx(E,{to:"/",children:"Tableau de bord"})})}),e.jsx(F,{}),e.jsx(A,{children:e.jsx(I,{asChild:!0,children:e.jsx(E,{to:"/salon",children:"Salon"})})}),e.jsx(F,{}),e.jsx(A,{children:e.jsx(I,{asChild:!0,children:e.jsx(E,{to:"/salon/informations",children:"Informations"})})})]})}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsx(he,{name:s.name,address:s.address,profilePicture:s.profilePicture,coverImage:s.coverImage,rmprofile:k,rmcover:C}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(y,{asChild:!0,children:e.jsx(N,{htmlFor:"profile",className:" w-full",children:"Changer ma photo de profil"})}),e.jsx(B,{className:"hidden",type:"file",id:"profile",onChange:b}),e.jsx(y,{asChild:!0,children:e.jsx(N,{htmlFor:"cover",className:" w-full",children:"Changer ma photo de couverture"})}),e.jsx(B,{className:"hidden",type:"file",id:"cover",onChange:b})]}),e.jsxs("form",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(S,{id:"name",label:"Nom du salon",type:"text",defaultValue:s.name,handleChange:f}),e.jsx(S,{id:"address",label:"Adresse",type:"text",defaultValue:s.address,handleChange:f}),e.jsx(S,{id:"phoneNumber",label:"Téléphone du salon",type:"tel",defaultValue:s.phoneNumber,handleChange:f}),e.jsx(S,{id:"email",label:"Email",type:"email",defaultValue:s.email,handleChange:f})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(M,{id:"autoAccept",checked:(t==null?void 0:t.autoAcceptAppointments)??s.autoAcceptAppointments,onCheckedChange:a=>{h({...t,autoAcceptAppointments:a})}})]}),e.jsxs("p",{className:"text-muted",children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(M,{id:"vacancyMode",checked:(t==null?void 0:t.isInVacancyMode)??s.isInVacancyMode,onCheckedChange:a=>{h({...t,isInVacancyMode:a})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:"text-muted",children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(N,{htmlFor:"terms",children:"Conditions de réservation"}),e.jsx(de,{id:"bookingTerms",type:"text",defaultValue:s.bookingTerms,onChange:f,className:"text-lg whitespace-pre-line"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:P,disabled:p,children:"Enregistrer les modifications"}),e.jsx(y,{variant:"outline",type:"reset",onClick:()=>{h()},children:"Annuler"})]})]})]})}export{ze as default};

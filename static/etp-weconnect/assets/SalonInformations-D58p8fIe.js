import{c as D,j as e,B as b,f as X,r as l,g as G,h as J,P as _,i as W,k as K,l as Q,a as B,u as Y,e as Z,m as ee,n as se,L as A,I as F,J as p}from"./index-7qE4wMN6.js";import{E as P}from"./EditableInput-B-eMrBQM.js";import{A as te,a as ae,b as re}from"./avatar-FoA3DQ_u.js";import{g as ne}from"./formatting-Cw3qGvmM.js";import{P as oe,a as ie,b as ce}from"./popover-D50s3LJ5.js";import{B as le,a as de,b as I,c as M,d as V}from"./breadcrumb-BMJETWS4.js";import{L as N}from"./label-DCCLqaws.js";import{T as ue}from"./textarea-D1LNvx15.js";import{u as pe}from"./useAxiosPrivate-BEZO7CEz.js";import"./axiosPrivate-BhUmTwXX.js";import"./index-Ey8vtPr0.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=D("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),he=()=>e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-3xl text-destructive",children:"Oops!"}),e.jsx("p",{children:"Une erreur s'est produite."})]}),fe=he;function xe({name:a,address:s,profilePicture:n,coverImage:i,rmprofile:m,rmcover:v}){const o=async d=>{try{d==="profile"&&await m(),d==="cover"&&await v()}catch(f){console.error(f)}};return e.jsxs("div",{className:"hero w-full aspect-video relative max-h-[40vh] sm:max-h-[20vh] rounded-md overflow-hidden",style:{backgroundImage:`url("${i&&i}")`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"hero-overlay bg-opacity-40"}),e.jsx("div",{className:"hero-content text-neutral-content mt-auto mr-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(te,{className:"w-16 h-16",children:[e.jsx(ae,{src:n}),e.jsx(re,{className:"text-2xl",children:a&&ne(a)})]}),e.jsxs("div",{className:"ml-4 space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold bg-muted px-2 py-1 rounded-sm w-fit",children:a}),e.jsx("p",{className:"bg-muted px-2 py-1 rounded-sm w-fit",children:s})]})]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(oe,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(b,{variant:"destructive",children:e.jsx(me,{})})}),e.jsxs(ce,{align:"end",className:"w-fit flex flex-col gap-2",children:[e.jsx(b,{variant:"outline",onClick:()=>o("profile"),children:"Supprimer la photo de profil"}),e.jsx(b,{variant:"outline",onClick:()=>o("cover"),children:"Supprimer la photo de couverture"})]})]})})]})}var L="Switch",[ve,Be]=X(L),[je,ge]=ve(L),H=l.forwardRef((a,s)=>{const{__scopeSwitch:n,name:i,checked:m,defaultChecked:v,required:o,disabled:d,value:f="on",onCheckedChange:t,...x}=a,[c,k]=l.useState(null),E=G(s,w=>k(w)),j=l.useRef(!1),C=c?!!c.closest("form"):!0,[y=!1,g]=J({prop:m,defaultProp:v,onChange:t});return e.jsxs(je,{scope:n,checked:y,disabled:d,children:[e.jsx(_.button,{type:"button",role:"switch","aria-checked":y,"aria-required":o,"data-state":$(y),"data-disabled":d?"":void 0,disabled:d,value:f,...x,ref:E,onClick:W(a.onClick,w=>{g(S=>!S),C&&(j.current=w.isPropagationStopped(),j.current||w.stopPropagation())})}),C&&e.jsx(be,{control:c,bubbles:!j.current,name:i,value:f,checked:y,required:o,disabled:d,style:{transform:"translateX(-100%)"}})]})});H.displayName=L;var q="SwitchThumb",U=l.forwardRef((a,s)=>{const{__scopeSwitch:n,...i}=a,m=ge(q,n);return e.jsx(_.span,{"data-state":$(m.checked),"data-disabled":m.disabled?"":void 0,...i,ref:s})});U.displayName=q;var be=a=>{const{control:s,checked:n,bubbles:i=!0,...m}=a,v=l.useRef(null),o=K(n),d=Q(s);return l.useEffect(()=>{const f=v.current,t=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(t,"checked").set;if(o!==n&&c){const k=new Event("click",{bubbles:i});c.call(f,n),f.dispatchEvent(k)}},[o,n,i]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...m,tabIndex:-1,ref:v,style:{...a.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function $(a){return a?"checked":"unchecked"}var O=H,ye=U;const T=l.forwardRef(({className:a,...s},n)=>e.jsx(O,{className:B("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...s,ref:n,children:e.jsx(ye,{className:B("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));T.displayName=O.displayName;const we=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,ke=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,Ne=["image/jpeg","image/jpg","image/png"];function Fe(){const{auth:a}=Y(),[s,n]=l.useState(a),[i,m]=l.useState(),[v,o]=l.useState(!1),[d,f]=l.useState(!1),[t,x]=l.useState(),c=pe(),k=Z(),E=ee();async function j(){var r;try{const{data:u}=await c.get("/api/salon");return n(u),u}catch(u){m(u),((r=u.response)==null?void 0:r.status)===401&&k("/login",{state:{from:E},replace:!0})}finally{f(!1)}}const C=async()=>{try{await c.delete("/api/s3/profile",{profilePicture:null}),await j()}catch(r){console.log(r)}},y=async()=>{try{await c.delete("/api/s3/cover",{coverImage:null}),await j()}catch(r){console.log(r)}},g=r=>{const{id:u,value:h}=r.target;x({...t,[u]:h})},w=async r=>{if(r.preventDefault(),o(!0),!t){o(!1),p("Aucune modification n'a été effectuée");return}if(!Object.keys(t).some(h=>t[h]!==s[h])){x(),o(!1),p("Aucune modification n'a été effectuée");return}if(t.phoneNumber&&!we.test(t.phoneNumber)){p.error("Le numéro de téléphone n'est pas valide"),o(!1);return}if(t.email&&!ke.test(t.email)){p.error("L'adresse email n'est pas valide"),o(!1);return}try{await c.patch("/api/salon",{...t}),await j(),p("Modifications enregistrées")}catch(h){h.response?p.error(h.response.data.message):p.error("Une erreur est survenue, veuillez contacter le support")}x(),o(!1)},S=async r=>{const{id:u,files:h}=r.target;Ne.includes(h[0].type)||p.error("Le format du fichier n'est pas valide");const z=new FormData;z.append(u,h[0]);try{await c.post(`/api/s3/${u}`,z,{headers:{"Content-Type":"multipart/form-data"}}),j(),p.success("Photo de profil mise à jour avec succès")}catch(R){R.response.status===413?p.error("Le fichier est trop volumineux"):(console.error(R.response.data.message),p.error("Une erreur est survenue, veuillez contacter le support"))}};return d?e.jsx(se,{className:"w-8 h-8 animate-spin flex-1"}):i?e.jsx(fe,{errMsg:i}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col gap-4",children:[e.jsx(le,{children:e.jsxs(de,{children:[e.jsx(I,{children:e.jsx(M,{asChild:!0,children:e.jsx(A,{to:"/",children:"Tableau de bord"})})}),e.jsx(V,{}),e.jsx(I,{children:e.jsx(M,{asChild:!0,children:e.jsx(A,{to:"/salon",children:"Salon"})})}),e.jsx(V,{}),e.jsx(I,{children:e.jsx(M,{asChild:!0,children:e.jsx(A,{to:"/salon/informations",children:"Informations"})})})]})}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsx(xe,{name:s.name,address:s.address,profilePicture:s.profilePicture,coverImage:s.coverImage,rmprofile:C,rmcover:y}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(b,{asChild:!0,children:e.jsx(N,{htmlFor:"profile",className:" w-full",children:"Changer ma photo de profil"})}),e.jsx(F,{className:"hidden",type:"file",id:"profile",onChange:S}),e.jsx(b,{asChild:!0,children:e.jsx(N,{htmlFor:"cover",className:" w-full",children:"Changer ma photo de couverture"})}),e.jsx(F,{className:"hidden",type:"file",id:"cover",onChange:S})]}),e.jsxs("form",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(P,{id:"name",label:"Nom du salon",type:"text",defaultValue:s.name,handleChange:g}),e.jsx(P,{id:"address",label:"Adresse",type:"text",defaultValue:s.address,handleChange:g}),e.jsx(P,{id:"phoneNumber",label:"Téléphone du salon",type:"tel",defaultValue:s.phoneNumber,handleChange:g}),e.jsx(P,{id:"email",label:"Email",type:"email",defaultValue:s.email,handleChange:g})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(T,{id:"autoAccept",checked:(t==null?void 0:t.autoAcceptAppointments)??s.autoAcceptAppointments,onCheckedChange:r=>{x({...t,autoAcceptAppointments:r})}})]}),e.jsxs("p",{className:"text-muted",children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(T,{id:"vacancyMode",checked:(t==null?void 0:t.isInVacancyMode)??s.isInVacancyMode,onCheckedChange:r=>{x({...t,isInVacancyMode:r})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:"text-muted",children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(N,{htmlFor:"terms",children:"Conditions de réservation"}),e.jsx(ue,{id:"bookingTerms",type:"text",defaultValue:s.bookingTerms,onChange:g,className:"text-lg whitespace-pre-line"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{onClick:w,disabled:v,children:"Enregistrer les modifications"}),e.jsx(b,{variant:"outline",type:"reset",onClick:()=>{x()},children:"Annuler"})]})]})]})}export{Fe as default};

import{c as X,j as e,B as b,f as G,r as d,g as J,h as W,P as _,i as K,k as Q,l as Y,a as V,u as Z,e as ee,m as se,L as M,I as B,J as m}from"./index-BI3dSPWw.js";import{E as S}from"./EditableInput-BWf4qqC6.js";import{A as te,a as ae,b as re}from"./avatar-BzNY5sVQ.js";import{g as oe}from"./formatting-Cw3qGvmM.js";import{P as ne,a as ce,b as ie}from"./popover-Blb-hZE_.js";import{B as le,a as de,b as T,c as z,d as F}from"./breadcrumb-B4A2uXso.js";import{L as w}from"./label-B1a82QHe.js";import{T as ue}from"./textarea-a7VQ5OsE.js";import{u as pe}from"./useAxiosPrivate-C50PbDUO.js";import"./axiosPrivate-BWLHhMm6.js";import"./index-BGOzz94f.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=X("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),he=()=>e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-2",children:[e.jsx("h1",{className:"text-3xl text-destructive",children:"Oops!"}),e.jsx("p",{children:"Une erreur s'est produite."})]}),fe=he;function xe({name:s,address:i,profilePicture:r,coverImage:t,rmprofile:o,rmcover:h}){const u=async l=>{try{l==="profile"&&await o(),l==="cover"&&await h()}catch(n){console.error(n)}};return e.jsxs("div",{className:"hero w-full aspect-video relative max-h-[40vh] sm:max-h-[20vh] rounded-md overflow-hidden",style:{backgroundImage:`url("${t&&t}")`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"hero-overlay bg-opacity-40"}),e.jsx("div",{className:"hero-content text-neutral-content mt-auto mr-auto",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(te,{className:"w-16 h-16",children:[e.jsx(ae,{src:r}),e.jsx(re,{className:"text-2xl",children:s&&oe(s)})]}),e.jsxs("div",{className:"ml-4 space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold bg-muted px-2 py-1 rounded-sm w-fit",children:s}),e.jsx("p",{className:"bg-muted px-2 py-1 rounded-sm w-fit",children:i})]})]})}),e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(ne,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(b,{variant:"destructive",children:e.jsx(me,{})})}),e.jsxs(ie,{align:"end",className:"w-fit flex flex-col gap-2",children:[e.jsx(b,{variant:"outline",onClick:()=>u("profile"),children:"Supprimer la photo de profil"}),e.jsx(b,{variant:"outline",onClick:()=>u("cover"),children:"Supprimer la photo de couverture"})]})]})})]})}var R="Switch",[ve,Ve]=G(R),[ge,je]=ve(R),H=d.forwardRef((s,i)=>{const{__scopeSwitch:r,name:t,checked:o,defaultChecked:h,required:u,disabled:l,value:n="on",onCheckedChange:f,...C}=s,[x,v]=d.useState(null),P=J(i,j=>v(j)),k=d.useRef(!1),N=x?!!x.closest("form"):!0,[p=!1,I]=W({prop:o,defaultProp:h,onChange:f});return e.jsxs(ge,{scope:r,checked:p,disabled:l,children:[e.jsx(_.button,{type:"button",role:"switch","aria-checked":p,"aria-required":u,"data-state":$(p),"data-disabled":l?"":void 0,disabled:l,value:n,...C,ref:P,onClick:K(s.onClick,j=>{I(a=>!a),N&&(k.current=j.isPropagationStopped(),k.current||j.stopPropagation())})}),N&&e.jsx(be,{control:x,bubbles:!k.current,name:t,value:n,checked:p,required:u,disabled:l,style:{transform:"translateX(-100%)"}})]})});H.displayName=R;var q="SwitchThumb",U=d.forwardRef((s,i)=>{const{__scopeSwitch:r,...t}=s,o=je(q,r);return e.jsx(_.span,{"data-state":$(o.checked),"data-disabled":o.disabled?"":void 0,...t,ref:i})});U.displayName=q;var be=s=>{const{control:i,checked:r,bubbles:t=!0,...o}=s,h=d.useRef(null),u=Q(r),l=Y(i);return d.useEffect(()=>{const n=h.current,f=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(f,"checked").set;if(u!==r&&x){const v=new Event("click",{bubbles:t});x.call(n,r),n.dispatchEvent(v)}},[u,r,t]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...o,tabIndex:-1,ref:h,style:{...s.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function $(s){return s?"checked":"unchecked"}var O=H,ye=U;const L=d.forwardRef(({className:s,...i},r)=>e.jsx(O,{className:V("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...i,ref:r,children:e.jsx(ye,{className:V("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));L.displayName=O.displayName;const ke=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,Ne=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,we=["image/jpeg","image/jpg","image/png"];function Be(){const{auth:s}=Z(),[i,r]=d.useState(s),[t,o]=d.useState({name:s.name,address:s.address,email:s.email,phoneNumber:s.phoneNumber,bookingTerms:s.bookingTerms,autoAcceptAppointments:s.autoAcceptAppointments,isInVacancyMode:s.isInVacancyMode,profilePicture:s.profilePicture,coverImage:s.coverImage}),[h,u]=d.useState(),[l,n]=d.useState(!1),f=pe(),C=ee(),x=se();async function v(){var a;try{const{data:c}=await f.get("/api/salon");return r(c),c}catch(c){u(c),((a=c.response)==null?void 0:a.status)===401&&C("/login",{state:{from:x},replace:!0})}}const P=async()=>{try{await f.delete("/api/s3/profile",{profilePicture:null}),await v()}catch(a){console.log(a)}},k=async()=>{try{await f.delete("/api/s3/cover",{coverImage:null}),await v()}catch(a){console.log(a)}},N=()=>{o({name:s.name,address:s.address,email:s.email,phoneNumber:s.phoneNumber,bookingTerms:s.bookingTerms,autoAcceptAppointments:s.autoAcceptAppointments,isInVacancyMode:s.isInVacancyMode,profilePicture:s.profilePicture,coverImage:s.coverImage})},p=a=>{const{id:c,value:g}=a.target;o({...t,[c]:g})},I=async a=>{a.preventDefault(),n(!0);const{name:c,email:g,phoneNumber:y}=t;if(!c||!g||!y){n(!1),m.error("Veuillez renseigner tous les champs obligatoires");return}if(!Object.keys(t).some(E=>t[E]!==i[E])){n(!1),m("Aucune modification n'a été effectuée");return}if(g&&!Ne.test(g)){m.error("L'adresse email n'est pas valide"),n(!1);return}if(y&&!ke.test(y)){m.error("Le numéro de téléphone n'est pas valide"),n(!1);return}const D={...t};o(D);try{await f.patch("/api/salon",{...t}),await v(),m("Modifications enregistrées")}catch{N(),m.error("Une erreur est survenue, veuillez contacter le support")}n(!1)},j=async a=>{const{id:c,files:g}=a.target;we.includes(g[0].type)||m.error("Le format du fichier n'est pas valide");const y=new FormData;y.append(c,g[0]);try{await f.post(`/api/s3/${c}`,y,{headers:{"Content-Type":"multipart/form-data"}}),v(),m.success("Photo de profil mise à jour avec succès")}catch(A){A.response.status===413?m.error("Le fichier est trop volumineux"):(console.error(A.response.data.message),m.error("Une erreur est survenue, veuillez contacter le support"))}};return h?e.jsx(fe,{errMsg:h}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col gap-4",children:[e.jsx(le,{children:e.jsxs(de,{children:[e.jsx(T,{children:e.jsx(z,{asChild:!0,children:e.jsx(M,{to:"/",children:"Tableau de bord"})})}),e.jsx(F,{}),e.jsx(T,{children:e.jsx(z,{asChild:!0,children:e.jsx(M,{to:"/salon",children:"Salon"})})}),e.jsx(F,{}),e.jsx(T,{children:e.jsx(z,{asChild:!0,children:e.jsx(M,{to:"/salon/informations",children:"Informations"})})})]})}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsx(xe,{name:t.name,address:t.address,profilePicture:t.profilePicture,coverImage:t.coverImage,rmprofile:P,rmcover:k}),e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(b,{asChild:!0,children:e.jsx(w,{htmlFor:"profile",className:" w-full",children:"Changer ma photo de profil"})}),e.jsx(B,{className:"hidden",type:"file",id:"profile",onChange:j}),e.jsx(b,{asChild:!0,children:e.jsx(w,{htmlFor:"cover",className:" w-full",children:"Changer ma photo de couverture"})}),e.jsx(B,{className:"hidden",type:"file",id:"cover",onChange:j})]}),e.jsxs("form",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2 md:space-y-0 md:grid grid-cols-2 md:gap-4",children:[e.jsx(S,{id:"name",label:"Nom du salon",type:"text",defaultValue:t.name,handleChange:p}),e.jsx(S,{id:"address",label:"Adresse",type:"text",defaultValue:t.address,handleChange:p}),e.jsx(S,{id:"phoneNumber",label:"Téléphone du salon",type:"tel",defaultValue:t.phoneNumber,handleChange:p}),e.jsx(S,{id:"email",label:"Email",type:"email",defaultValue:t.email,handleChange:p})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(L,{id:"autoAccept",checked:t==null?void 0:t.autoAcceptAppointments,onCheckedChange:a=>{o({...t,autoAcceptAppointments:a})}})]}),e.jsxs("p",{className:"text-muted",children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:"bg-white rounded-md px-3 py-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(L,{id:"vacancyMode",checked:t==null?void 0:t.isInVacancyMode,onCheckedChange:a=>{o({...t,isInVacancyMode:a})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:"text-muted",children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(w,{htmlFor:"terms",children:"Conditions de réservation"}),e.jsx(ue,{id:"bookingTerms",type:"text",defaultValue:t.bookingTerms,onChange:p,className:"text-lg whitespace-pre-line"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{onClick:I,disabled:l,children:"Enregistrer les modifications"}),e.jsx(b,{variant:"outline",type:"reset",onClick:N,children:"Annuler"})]})]})]})}export{Be as default};

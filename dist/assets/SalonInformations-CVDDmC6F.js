import{j as e,I as B,e as V,r as o,f as F,g as H,P as R,h as O,i as U,k as X,l as I,u as D,a as G,b as W,L as M,E as J,B as w}from"./index-CP035eP3.js";import{L as S}from"./label-BBwN9drT.js";const K=({id:t,label:c,type:n,value:u,edit:d,handleChange:h})=>e.jsxs("div",{children:[e.jsx(S,{htmlFor:t,children:c}),e.jsx(B,{disabled:!d,id:t,type:n,value:d?null:u,onChange:h,className:"text-lg"})]}),C=K;var P="Switch",[Q,oe]=V(P),[Y,Z]=Q(P),z=o.forwardRef((t,c)=>{const{__scopeSwitch:n,name:u,checked:d,defaultChecked:h,required:s,disabled:l,value:a="on",onCheckedChange:p,...y}=t,[i,b]=o.useState(null),f=F(c,m=>b(m)),g=o.useRef(!1),k=i?!!i.closest("form"):!0,[j=!1,N]=H({prop:d,defaultProp:h,onChange:p});return e.jsxs(Y,{scope:n,checked:j,disabled:l,children:[e.jsx(R.button,{type:"button",role:"switch","aria-checked":j,"aria-required":s,"data-state":q(j),"data-disabled":l?"":void 0,disabled:l,value:a,...y,ref:f,onClick:O(t.onClick,m=>{N(E=>!E),k&&(g.current=m.isPropagationStopped(),g.current||m.stopPropagation())})}),k&&e.jsx(ee,{control:i,bubbles:!g.current,name:u,value:a,checked:j,required:s,disabled:l,style:{transform:"translateX(-100%)"}})]})});z.displayName=P;var L="SwitchThumb",_=o.forwardRef((t,c)=>{const{__scopeSwitch:n,...u}=t,d=Z(L,n);return e.jsx(R.span,{"data-state":q(d.checked),"data-disabled":d.disabled?"":void 0,...u,ref:c})});_.displayName=L;var ee=t=>{const{control:c,checked:n,bubbles:u=!0,...d}=t,h=o.useRef(null),s=U(n),l=X(c);return o.useEffect(()=>{const a=h.current,p=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(p,"checked").set;if(s!==n&&i){const b=new Event("click",{bubbles:u});i.call(a,n),a.dispatchEvent(b)}},[s,n,u]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...d,tabIndex:-1,ref:h,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function q(t){return t?"checked":"unchecked"}var T=z,te=_;const A=o.forwardRef(({className:t,...c},n)=>e.jsx(T,{className:I("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...c,ref:n,children:e.jsx(te,{className:I("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));A.displayName=T.displayName;const se=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,ae=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;function ie(){const[t,c]=o.useState(),[n,u]=o.useState(),[d,h]=o.useState(!0),[s,l]=o.useState(!1),[a,p]=o.useState({}),[y,i]=o.useState(!1),[b,f]=o.useState(!1),g=D(),k=G(),j=W();async function N(){var r;try{const v=await g.get("/api/users");c(v.data),p(x=>({...x,isInVacancyMode:v.data.isInVacancyMode,autoAcceptAppointments:v.data.autoAcceptAppointments}))}catch(v){u(v),((r=v.response)==null?void 0:r.status)===401&&k("/login",{state:{from:j},replace:!0})}h(!1)}o.useEffect(()=>{N()},[]);const m=r=>{p({...a,[r.target.id]:r.target.value})},E=async r=>{if(r.preventDefault(),i(!0),a.phoneNumber&&!se.test(a.phoneNumber)){f("Le numéro de téléphone n'est pas valide"),i(!1);return}if(a.email&&!ae.test(a.email)){f("L'adresse email n'est pas valide"),i(!1);return}if(!Object.keys(a).some(x=>a[x]!==t[x])){l(!1),i(!1);return}try{await g.patch("/api/users",a),await N()}catch(x){x.response?f(x.response.data.message):f("Une erreur est survenue, veuillez réessayer plus tard")}l(!1),i(!1)},$=()=>{p({isInVacancyMode:response.data.isInVacancyMode,autoAcceptAppointments:response.data.autoAcceptAppointments}),document.querySelector("#provider-infos-section").querySelectorAll("input").forEach(r=>{if(a[r.id]){r.value=t.phoneNumber;return}r.value=""})};return d?e.jsx(M,{className:"w-8 h-8 animate-spin flex-1"}):n?e.jsx(J,{errMsg:n}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col space-y-4",children:[e.jsx(w,{variant:"link",className:"justify-start h-0 p-0",onClick:()=>k(-1),children:"Retour"}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsxs("section",{id:"provider-infos-section",className:"relative space-y-2",children:[e.jsx(C,{id:"phoneNumber",label:"Téléphone",type:"tel",value:t.phoneNumber,edit:s,handleChange:m}),e.jsx(C,{id:"email",label:"Email",type:"email",value:t.email,edit:s,handleChange:m}),e.jsx(C,{id:"address",label:"Adresse",type:"text",value:t.address,edit:s,handleChange:m}),e.jsx(C,{id:"providerName",label:"Nom du salon",type:"text",value:t.providerName,edit:s,handleChange:m}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:`${s?"bg-white":"bg-white/50"} rounded-md px-3 py-2 space-y-4`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{className:s?"":"text-muted",children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(A,{id:"autoAccept",disabled:!s,checked:a.autoAcceptAppointments,onCheckedChange:r=>{p({...a,autoAcceptAppointments:r})}})]}),e.jsxs("p",{className:`text-muted ${!s&&"hidden"}`,children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:`${s?"bg-white":"bg-white/50"} rounded-md px-3 py-2 space-y-4`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{className:s?"text-destructive":"text-muted",children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(A,{id:"vacancyMode",disabled:!s,checked:a.isInVacancyMode,onCheckedChange:r=>{p({...a,isInVacancyMode:r})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:`text-muted ${!s&&"hidden"}`,children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),b&&setTimeout(()=>f(null),3e3)&&e.jsx("p",{className:"text-destructive text-sm",children:b}),s?e.jsxs(e.Fragment,{children:[e.jsx(w,{onClick:E,disabled:y&&!0,children:y?e.jsx(M,{className:"animate-spin"}):"Enregistrer les modifications"}),e.jsx(w,{variant:"outline",className:"block",onClick:()=>{l(!1),$()},children:"Annuler les modifications"})]}):e.jsx(w,{variant:"outline",onClick:()=>l(!0),children:"Modifier mes informations"})]})]})}export{ie as default};

import{r,j as e,P as M,e as A,f as D,I as F,g as H,h as O,i as U,k as X,l as G,m as W,u as J,a as K,b as Q,L as R,E as Y,B as k}from"./index-BmpazVu2.js";var Z="Label",L=r.forwardRef((t,o)=>e.jsx(M.label,{...t,ref:o,onMouseDown:s=>{var c;s.target.closest("button, input, select, textarea")||((c=t.onMouseDown)==null||c.call(t,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));L.displayName=Z;var z=L;const ee=D("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),C=r.forwardRef(({className:t,...o},s)=>e.jsx(z,{ref:s,className:A(ee(),t),...o}));C.displayName=z.displayName;const te=({id:t,label:o,type:s,value:l,edit:c,handleChange:h})=>e.jsxs("div",{children:[e.jsx(C,{htmlFor:t,children:o}),e.jsx(F,{disabled:!c,id:t,type:s,value:c?null:l,onChange:h,className:"text-lg"})]}),E=te;var I="Switch",[se,le]=H(I),[ae,ne]=se(I),$=r.forwardRef((t,o)=>{const{__scopeSwitch:s,name:l,checked:c,defaultChecked:h,required:a,disabled:u,value:n="on",onCheckedChange:p,...y}=t,[d,b]=r.useState(null),f=O(o,m=>b(m)),g=r.useRef(!1),N=d?!!d.closest("form"):!0,[j=!1,w]=U({prop:c,defaultProp:h,onChange:p});return e.jsxs(ae,{scope:s,checked:j,disabled:u,children:[e.jsx(M.button,{type:"button",role:"switch","aria-checked":j,"aria-required":a,"data-state":T(j),"data-disabled":u?"":void 0,disabled:u,value:n,...y,ref:f,onClick:X(t.onClick,m=>{w(S=>!S),N&&(g.current=m.isPropagationStopped(),g.current||m.stopPropagation())})}),N&&e.jsx(re,{control:d,bubbles:!g.current,name:l,value:n,checked:j,required:a,disabled:u,style:{transform:"translateX(-100%)"}})]})});$.displayName=I;var _="SwitchThumb",q=r.forwardRef((t,o)=>{const{__scopeSwitch:s,...l}=t,c=ne(_,s);return e.jsx(M.span,{"data-state":T(c.checked),"data-disabled":c.disabled?"":void 0,...l,ref:o})});q.displayName=_;var re=t=>{const{control:o,checked:s,bubbles:l=!0,...c}=t,h=r.useRef(null),a=G(s),u=W(o);return r.useEffect(()=>{const n=h.current,p=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(p,"checked").set;if(a!==s&&d){const b=new Event("click",{bubbles:l});d.call(n,s),n.dispatchEvent(b)}},[a,s,l]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...c,tabIndex:-1,ref:h,style:{...t.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function T(t){return t?"checked":"unchecked"}var B=$,oe=q;const P=r.forwardRef(({className:t,...o},s)=>e.jsx(B,{className:A("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...o,ref:s,children:e.jsx(oe,{className:A("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));P.displayName=B.displayName;const ie=/^(?:(?:\+|00)33\s?[1-9](?:[\s.-]?\d{2}){4}|0[1-9](?:[\s.-]?\d{2}){4})$/,ce=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;function ue(){const[t,o]=r.useState(),[s,l]=r.useState(),[c,h]=r.useState(!0),[a,u]=r.useState(!1),[n,p]=r.useState({}),[y,d]=r.useState(!1),[b,f]=r.useState(!1),g=J(),N=K(),j=Q();async function w(){var i;try{const v=await g.get("/api/users");o(v.data),p(x=>({...x,isInVacancyMode:v.data.isInVacancyMode,autoAcceptAppointments:v.data.autoAcceptAppointments}))}catch(v){l(v),((i=v.response)==null?void 0:i.status)===401&&N("/login",{state:{from:j},replace:!0})}h(!1)}r.useEffect(()=>{w()},[]);const m=i=>{p({...n,[i.target.id]:i.target.value})},S=async i=>{if(i.preventDefault(),d(!0),n.phoneNumber&&!ie.test(n.phoneNumber)){f("Le numéro de téléphone n'est pas valide"),d(!1);return}if(n.email&&!ce.test(n.email)){f("L'adresse email n'est pas valide"),d(!1);return}if(!Object.keys(n).some(x=>n[x]!==t[x])){u(!1),d(!1);return}try{await g.patch("/api/users",n),await w()}catch(x){x.response?f(x.response.data.message):f("Une erreur est survenue, veuillez réessayer plus tard")}u(!1),d(!1)},V=()=>{p({isInVacancyMode:response.data.isInVacancyMode,autoAcceptAppointments:response.data.autoAcceptAppointments}),document.querySelector("#provider-infos-section").querySelectorAll("input").forEach(i=>{if(n[i.id]){i.value=t.phoneNumber;return}i.value=""})};return c?e.jsx(R,{className:"w-8 h-8 animate-spin flex-1"}):s?e.jsx(Y,{errMsg:s}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col space-y-4",children:[e.jsx(k,{variant:"link",className:"justify-start h-0 p-0",onClick:()=>N(-1),children:"Retour"}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes informations"}),e.jsxs("section",{id:"provider-infos-section",className:"relative space-y-2",children:[e.jsx(E,{id:"phoneNumber",label:"Téléphone",type:"tel",value:t.phoneNumber,edit:a,handleChange:m}),e.jsx(E,{id:"email",label:"Email",type:"email",value:t.email,edit:a,handleChange:m}),e.jsx(E,{id:"address",label:"Adresse",type:"text",value:t.address,edit:a,handleChange:m}),e.jsx(E,{id:"providerName",label:"Nom du salon",type:"text",value:t.providerName,edit:a,handleChange:m}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"autoAccept",children:"Confirmation automatique"}),e.jsxs("div",{className:`${a?"bg-white":"bg-white/50"} rounded-md px-3 py-2 space-y-4`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{className:a?"":"text-muted",children:"Choisissez ou non d'accepter automatiquement les demandes de rendez-vous."}),e.jsx(P,{id:"autoAccept",disabled:!a,checked:n.autoAcceptAppointments,onCheckedChange:i=>{p({...n,autoAcceptAppointments:i})}})]}),e.jsxs("p",{className:`text-muted ${!a&&"hidden"}`,children:["Si vous choisissez de ne pas accepter automatiquement les demandes de rendez-vous, elles auront le status ",e.jsx("b",{children:"En attente"})," tant que vous ne les aurez pas confirmées ou refusées."]})]})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"vacancyMode",className:"text-destructive",children:"Mode vacances"}),e.jsxs("div",{className:`${a?"bg-white":"bg-white/50"} rounded-md px-3 py-2 space-y-4`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("p",{className:a?"text-destructive":"text-muted",children:"Passez en mode vacances pour ne plus recevoir de demandes de rendez-vous."}),e.jsx(P,{id:"vacancyMode",disabled:!a,checked:n.isInVacancyMode,onCheckedChange:i=>{p({...n,isInVacancyMode:i})},className:"data-[state=checked]:bg-destructive"})]}),e.jsx("p",{className:`text-muted ${!a&&"hidden"}`,children:"En cas de fermerture temporaire de votre salon, vous pouvez activer le mode vacances pour ne plus recevoir de demandes de rendez-vous pendant un certain temps."})]})]}),b&&setTimeout(()=>f(null),3e3)&&e.jsx("p",{className:"text-destructive text-sm",children:b}),a?e.jsxs(e.Fragment,{children:[e.jsx(k,{onClick:S,disabled:y&&!0,children:y?e.jsx(R,{className:"animate-spin"}):"Enregistrer les modifications"}),e.jsx(k,{variant:"outline",className:"block",onClick:()=>{u(!1),V()},children:"Annuler les modifications"})]}):e.jsx(k,{variant:"outline",onClick:()=>u(!0),children:"Modifier mes informations"})]})]})}export{ue as default};

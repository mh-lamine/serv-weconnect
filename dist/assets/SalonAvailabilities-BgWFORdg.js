import{c as ne,r as l,y as V,j as e,D as F,z as P,B as d,C as Y,F as U,G as I,H as R,I as m,J as $,K as H,v as C,N as J,O as B,Q as G,R as Q,S as W,U as K,V as X,W as Z,X as D,Y as A,Z as S,_ as T,$ as k,a0 as L,a1 as M,a2 as _,u as re,b as le,t as ce,T as de,e as ue,f as O,d as z,M as q}from"./index-C0y5ghfn.js";import{C as E}from"./circle-plus-686ATquU.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=ne("CircleMinus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]),oe=({dayOfWeek:v,createAvailability:x})=>{const[s,t]=l.useState(!1),[n,a]=l.useState(),[u,h]=l.useState(!1),[j,r]=l.useState(),p=V("(min-width: 768px)"),N=f=>{a({...n,[f.target.name]:f.target.value})},o=async f=>{if(f.preventDefault(),!(n!=null&&n.startTime)||!(n!=null&&n.endTime)){r("Veuillez renseigner une heure de début et une heure de fin.");return}if(n.startTime>=n.endTime){r("L'heure de début doit être avant l'heure de début.");return}h(!0);try{await x({dayOfWeek:v,...n}),t(!1)}catch{r("Une disponibilité se chevauche déjà avec cet intervalle.")}h(!1)};return l.useEffect(()=>{s||a()},[s]),p?e.jsxs(F,{open:s,onOpenChange:t,children:[e.jsx(P,{asChild:!0,children:e.jsx(d,{children:e.jsx(E,{})})}),e.jsxs(Y,{className:"sm:max-w-[425px]",children:[e.jsxs(U,{children:[e.jsx(I,{children:"Ajouter un créneau"}),e.jsx(R,{children:"Selectionnez une heure de début et une heure de fin pour créer un créneau de disponibilité."})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:["De",e.jsx(m,{className:"w-fit",name:"startTime",type:"time",onChange:N}),"à",e.jsx(m,{className:"w-fit",name:"endTime",type:"time",onChange:N})]}),j&&setTimeout(()=>r(null),3e3)&&e.jsx("p",{className:"text-destructive text-sm",children:j}),e.jsx($,{className:"sm:justify-start",children:e.jsx(H,{asChild:!0,children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx(d,{variant:"outline",onClick:()=>a(),children:"Annuler"}),e.jsx(d,{onClick:o,disabled:u&&!0,children:u?e.jsx(C,{className:"animate-spin"}):"Ajouter"})]})})})]})]}):e.jsxs(J,{open:s,onOpenChange:t,children:[e.jsx(B,{asChild:!0,children:e.jsx(d,{children:e.jsx(E,{})})}),e.jsxs(G,{children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Ajouter un créneau"}),e.jsx(K,{children:"Selectionnez une heure de début et une heure de fin pour créer un créneau de disponibilité."})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4",children:["De",e.jsx(m,{className:"w-fit",name:"startTime",type:"time",onChange:N}),"à",e.jsx(m,{className:"w-fit",name:"endTime",type:"time",onChange:N})]}),e.jsxs(X,{className:"pt-2",children:[j&&setTimeout(()=>r(null),3e3)&&e.jsx("p",{className:"text-destructive text-sm",children:j}),e.jsx(Z,{asChild:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"w-full",onClick:o,disabled:u&&!0,children:u?e.jsx(C,{className:"animate-spin"}):"Ajouter"}),e.jsx(d,{className:"w-full",variant:"outline",onClick:()=>a(),children:"Annuler"})]})})]})]})]})},me=({createSpecialAvailability:v})=>{const[x,s]=l.useState(!1),[t,n]=l.useState(),[a,u]=l.useState(),[h,j]=l.useState(!1),[r,p]=l.useState(),N=V("(min-width: 768px)"),o=g=>{u({...a,[g.target.name]:g.target.value})},f=async g=>{if(g.preventDefault(),!t||!(a!=null&&a.startTime)||!(a!=null&&a.endTime)){p("Veuillez renseigner une date, une heure de début et une heure de fin.");return}if(a.startTime>=a.endTime){p("L'heure de début doit être avant l'heure de début.");return}j(!0);try{await v({date:_.fromJSDate(t).toISODate(),...a}),s(!1)}catch{p("Une disponibilité se chevauche déjà avec cet intervalle.")}finally{j(!1)}};return l.useEffect(()=>{x||u()},[x]),N?e.jsxs(F,{open:x,onOpenChange:s,children:[e.jsx(P,{asChild:!0,children:e.jsx(d,{variant:"link",className:"h-min p-0",children:"Ajouter une disponibilité"})}),e.jsxs(Y,{className:"sm:max-w-[425px]",children:[e.jsxs(U,{children:[e.jsx(I,{children:"Ajouter un créneau"}),e.jsx(R,{children:"Selectionnez une date, une heure de début et une heure de fin pour créer un créneau de disponibilité."})]}),e.jsxs(D,{children:[e.jsx(A,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"w-full",children:[t?e.jsx("span",{children:S(t)}):e.jsx("span",{children:"Choisir une date"}),e.jsx(T,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(k,{className:"w-auto p-0",align:"start",children:e.jsx(L,{mode:"single",selected:t,onSelect:n,initialFocus:!0,locale:M})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:["De",e.jsx(m,{className:"w-fit",name:"startTime",type:"time",onChange:o}),"à",e.jsx(m,{className:"w-fit",name:"endTime",type:"time",onChange:o})]}),r&&setTimeout(()=>p(null),3e3)&&e.jsx("p",{className:"text-destructive text-sm",children:r}),e.jsx($,{className:"sm:justify-start",children:e.jsx(H,{asChild:!0,children:e.jsxs("div",{className:"w-full flex items-center justify-between",children:[e.jsx(d,{variant:"outline",onClick:()=>u(),children:"Annuler"}),e.jsx(d,{onClick:f,disabled:h&&!0,children:h?e.jsx(C,{className:"animate-spin"}):"Ajouter"})]})})})]})]}):e.jsxs(J,{open:x,onOpenChange:s,children:[e.jsx(B,{asChild:!0,children:e.jsx(d,{variant:"link",className:"h-min p-0",children:"Ajouter une disponibilité"})}),e.jsxs(G,{children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Ajouter un créneau"}),e.jsx(K,{children:"Selectionnez une date, une heure de début et une heure de fin pour créer un créneau de disponibilité."})]}),e.jsx(D,{children:e.jsxs("div",{className:"px-4 pb-2",children:[e.jsx(A,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"w-full",children:[t?e.jsx("span",{children:S(t)}):e.jsx("span",{children:"Choisir une date"}),e.jsx(T,{className:"ml-auto h-4 w-4 opacity-50"})]})}),e.jsx(k,{className:"w-auto p-0",children:e.jsx(L,{mode:"single",selected:t,onSelect:n,initialFocus:!0,locale:M})})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4",children:["De",e.jsx(m,{className:"w-fit",name:"startTime",type:"time",onChange:o}),"à",e.jsx(m,{className:"w-fit",name:"endTime",type:"time",onChange:o})]}),e.jsxs(X,{className:"pt-2",children:[r&&setTimeout(()=>p(null),3e3)&&e.jsx("p",{className:"text-destructive text-sm",children:r}),e.jsx(Z,{asChild:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"w-full",onClick:f,disabled:h&&!0,children:h?e.jsx(C,{className:"animate-spin"}):"Ajouter"}),e.jsx(d,{className:"w-full",variant:"outline",onClick:()=>u(),children:"Annuler"})]})})]})]})]})},pe=()=>{const v={Lundi:"MONDAY",Mardi:"TUESDAY",Mercredi:"WEDNESDAY",Jeudi:"THURSDAY",Vendredi:"FRIDAY",Samedi:"SATURDAY",Dimanche:"SUNDAY"},[x,s]=l.useState(),[t,n]=l.useState(),[a,u]=l.useState(),[h,j]=l.useState(!0),r=re(),p=le(),N=ce();l.useEffect(()=>{o()},[]);async function o(){var i;try{const c=await r.get("/api/availabilities");s(te(c.data.availabilities)),n(c.data.specialAvailabilities)}catch(c){u(c),((i=c.response)==null?void 0:i.status)===401&&p("/login",{state:{from:N},replace:!0})}j(!1)}async function f(i){await r.post("/api/availabilities",i),o()}async function g(i){await r.post("/api/availabilities/special",i),o()}async function b(i){await r.delete(`/api/availabilities/${i}`),o()}async function se(i){await r.delete(`/api/availabilities/special/${i}`),o()}function te(i){const c={};return i==null||i.forEach(({id:y,dayOfWeek:w,startTime:ae,endTime:ie})=>{c[w]||(c[w]=[]),c[w].push({id:y,start:ae,end:ie})}),c}return h?e.jsx(C,{className:"w-8 h-8 animate-spin flex-1"}):e.jsxs("main",{className:"w-full max-w-screen-md mx-auto p-6 flex flex-1 flex-col space-y-4",children:[e.jsx(d,{variant:"link",className:"justify-start h-0 p-0",onClick:()=>p(-1),children:"Retour"}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Mes disponibilités"}),e.jsxs(de,{defaultValue:"weekly",className:"space-y-4",children:[e.jsxs(ue,{children:[e.jsx(O,{value:"weekly",children:"Par semaine"}),e.jsx(O,{value:"daily",children:"Par jour"})]}),e.jsxs(z,{value:"weekly",children:[e.jsx("p",{className:"text-muted pb-4",children:"Gérez vos horaires de travail hebdomadaires."}),Object.entries(v).map(([i,c],y)=>e.jsxs("div",{children:[e.jsx(xe,{dayFR:i,dayEN:c,availabilities:x&&x[c],createAvailability:f,removeAvailability:b}),y!==Object.entries(v).length-1&&e.jsx("div",{className:"divider w-1/2 mx-auto"})]},y))]}),e.jsxs(z,{value:"daily",children:[e.jsx("p",{className:"text-muted pb-4",children:"Définissez des horaires spéciales pour des jours précis."}),e.jsx(me,{createSpecialAvailability:g}),t!=null&&t.length?t.map(({id:i,date:c,startTime:y,endTime:w})=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsx("span",{className:"flex-1 text-2xl font-medium",children:_.fromISO(c).toFormat("DDDD")}),e.jsxs("div",{className:"flex flex-1 gap-2",children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(m,{disabled:!0,type:"time",defaultValue:y,className:"!opacity-100 w-min"}),e.jsx("div",{className:"divider divider-horizontal m-0"}),e.jsx(m,{disabled:!0,type:"time",defaultValue:w,className:"!opacity-100 w-min"})]}),e.jsx(q,{id:i,action:se,actionLabel:"Supprimer",variant:"destructive",title:"Supprimer une disponibilité spéciale",description:"Êtes-vous sûr de vouloir supprimer cette disponibilité spéciale ?",trigger:e.jsx(ee,{className:"text-destructive"}),triggerVariant:"ghost"})]})]},i)):e.jsx("p",{className:"text-muted",children:"Aucune disponibilité spéciale"})]})]})]})},xe=({dayFR:v,dayEN:x,availabilities:s,createAvailability:t,removeAvailability:n})=>e.jsxs("section",{className:`flex flex-col sm:flex-row gap-4 ${!(s!=null&&s.length)&&"text-muted sm:items-center"}`,children:[e.jsx("span",{className:"text-xl font-medium sm:flex-1",children:v}),s!=null&&s.length?e.jsx("div",{className:"space-y-2 sm:flex-2",children:s==null?void 0:s.map(({id:a,start:u,end:h},j)=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx(m,{disabled:!0,type:"time",defaultValue:u,className:"!opacity-100 w-min"}),e.jsx("div",{className:"divider divider-horizontal m-0"}),e.jsx(m,{disabled:!0,type:"time",defaultValue:h,className:"!opacity-100 w-min"}),e.jsx(q,{id:a,action:n,actionLabel:"Supprimer",variant:"destructive",title:"Supprimer un créneau",description:"Êtes-vous sûr de vouloir supprimer ce créneau de disponibilité ?",trigger:e.jsx(ee,{className:"text-destructive"}),triggerVariant:"ghost"})]},a))}):e.jsx("div",{className:"sm:flex-2",children:"Fermé"}),e.jsx("div",{className:"flex sm:flex-1 justify-end",children:e.jsx(oe,{dayOfWeek:x,createAvailability:t})})]});export{pe as default};
